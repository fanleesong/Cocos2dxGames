{"version":3,"sources":["HelloWorld.js"],"names":["MyUtils","require","cc","Class","extends","Component","properties","label","default","type","Label","text","onLoad","string","__initCfg","cardNum","_cardNum","posX","posY","ratioVal","radiusVal","num","szBack","szFont","getCardNameByCompsiteNum","RubCardLayer_State_Move","RubCardLayer_State_Smooth","RubCardLayer_Pai","RubCardLayer_RotationFrame","RubCardLayer_RotationAnger","RubCardLayer_SmoothFrame","RubCardLayer_SmoothAnger","state","__createTextures","__initTexAndPos","__createGlNode","__createAllProgram","__registTouchEvent","pokerHeight","openCard","action","callFunc","sp","Node","addComponent","Sprite","spriteFrame","SpriteFrame","frontSprite","node","parent","setContentSize","size","rotation","setPosition","p","yanse","nType","GetType","eCardType","eCard_Diamond","eCard_Heart","eCard_Sword","eCard_Club","huashe","imgUrl","url","raw","texture","textureCache","addImage","hs1","setScale","opacity","hs2","GetCardFaceNum","imgUrl1","texture1","ys1","ys2","runAction","fadeIn","_sgNode","removeChild","glnode","layer","onDestroy","sequence","delayTime","GLNode","addChild","smoothFrame","isCreateNum","draw","console","log","__drawByMoveProgram","scale","__drawBySmoothProgram","Math","max","__drawByEndProgram","_isopen","bind","Layer","self","eventManager","addListener","event","EventListener","TOUCH_ONE_BY_ONE","onTouchBegan","touch","onTouchMoved","location","getLocation","y","touchStartY","min","onTouchEnded","moveVertSource","smoothVertSource","endVertSource","strFragSource","moveGlProgram","__createProgram","smoothGlProgram","endGlProgram","retain","rotationLc","gl","getUniformLocation","getProgram","ratio","radius","offx","offy","Height","Width","vsource","fsource","glProgram","GLProgram","createWithByteArrays","link","updateUniforms","enable","CULL_FACE","use","setUniformsForBuiltins","setUniformLocationF32","pokerWidth","bindTexture","TEXTURE_2D","backSpriteId","__drawArrays","backPosBuffer","backTexBuffer","frontSpriteId","frontPosBuffer","frontTexBuffer","disable","pos","tex","VERTEX_ATTRIB_FLAG_POSITION","VERTEX_ATTRIB_FLAG_TEX_COORDS","glEnableVertexAttribs","VERTEX_ATTRIB_POSITION","VERTEX_ATTRIB_TEX_COORDS","bindBuffer","ARRAY_BUFFER","vertexAttribPointer","FLOAT","drawArrays","TRIANGLES","posTexNum","isBack","nDiv","verts","Array","texs","dh","dw","c","x","quad","i","quadX","quadY","numX","numY","push","k","posBuffer","createBuffer","bufferData","Float32Array","STATIC_DRAW","length","texBuffer","buffer_id","backSprite","pokerSize","getContentSize","height","width","getName","winSize","_deleteBuffer","release"],"mappings":";;;;;;AAAA,IAAIA,UAAUC,QAAQ,SAAR,CAAd;AACAC,GAAGC,KAAH,CAAS;AACLC,aAASF,GAAGG,SADP;;AAGLC,gBAAY;AACRC,eAAO;AACHC,qBAAS,IADN;AAEHC,kBAAMP,GAAGQ;AAFN,SADC;AAKR;AACAC,cAAM;AANE,KAHP;;AAYLC,YAAQ,kBAAY;AAChB,aAAKL,KAAL,CAAWM,MAAX,GAAoB,KAAKF,IAAzB;AACA,aAAKG,SAAL,CAAe,EAAf;AACH,KAfI;;AAiBLA,eAAW,mBAAUC,OAAV,EAAmB;AAC1B,aAAKC,QAAL,GAAgBD,OAAhB;AACA,aAAKE,IAAL,GAAY,CAAZ;AACA,aAAKC,IAAL,GAAY,CAAC,EAAb;AACA,aAAKC,QAAL,GAAgB,CAAhB;AACA,aAAKC,SAAL,GAAiB,CAAjB;AACA,YAAIC,MAAM,CAAV;AACA,aAAKC,MAAL,GAAc,8BAAd;AACA,aAAKC,MAAL,GAAc,oBAAoBvB,QAAQwB,wBAAR,CAAiCT,OAAjC,CAApB,GAAgE,MAA9E;AACA,aAAKU,uBAAL,GAA+B,CAA/B;AACA,aAAKC,yBAAL,GAAiC,CAAjC;AACA,YAAIC,mBAAmB,QAAvB;AACA,aAAKC,0BAAL,GAAkC,EAAlC;AACA,aAAKC,0BAAL,GAAkCF,mBAAmB,CAArD;AACA,aAAKG,wBAAL,GAAgC,EAAhC;AACA,aAAKC,wBAAL,GAAgCJ,mBAAmB,CAAnD;;AAEA,aAAKK,KAAL,GAAa,KAAKP,uBAAlB;;AAEA,aAAKQ,gBAAL;AACA,aAAKC,eAAL,CAAqB,IAArB;AACA,aAAKA,eAAL,CAAqB,KAArB;AACA,aAAKC,cAAL;AACA,aAAKC,kBAAL;AACA,aAAKC,kBAAL;AACA,aAAKjB,SAAL,GAAiB,KAAKkB,WAAL,GAAmB,EAApC;AACH,KA3CI;AA4CTC,cAAW,oBAAY;AAAA;;AACnB,YAAIC,SAAStC,GAAGuC,QAAH,CAAY,YAAM;AAC3B,gBAAIC,KAAM,IAAIxC,GAAGyC,IAAP,EAAD,CAAgBC,YAAhB,CAA6B1C,GAAG2C,MAAhC,CAAT;AACAH,eAAGI,WAAH,GAAiB,IAAI5C,GAAG6C,WAAP,CAAmB,MAAKC,WAAxB,CAAjB;AACAN,eAAGO,IAAH,CAAQC,MAAR,GAAiB,MAAKD,IAAtB;AACAP,eAAGO,IAAH,CAAQE,cAAR,CAAuBjD,GAAGkD,IAAH,CAAQ,GAAR,EAAa,GAAb,CAAvB;AACAV,eAAGO,IAAH,CAAQI,QAAR,GAAmB,EAAnB;AACAX,eAAGO,IAAH,CAAQK,WAAR,CAAoBpD,GAAGqD,CAAH,CAAK,MAAKtC,IAAV,EAAgB,MAAKC,IAArB,CAApB;;AAEA,gBAAIsC,QAAQ,EAAZ;AACA,gBAAIC,QAAQ,CAAZ;AACA,oBAAQzD,QAAQ0D,OAAR,CAAgB,MAAK1C,QAArB,CAAR;AACI,qBAAKhB,QAAQ2D,SAAR,CAAkBC,aAAvB;AACIH,4BAAQ,CAAR;AACAD,4BAAQ,MAAR;AACA;AACJ,qBAAKxD,QAAQ2D,SAAR,CAAkBE,WAAvB;AACIJ,4BAAQ,CAAR;AACAD,4BAAQ,MAAR;AACA;AACJ,qBAAKxD,QAAQ2D,SAAR,CAAkBG,WAAvB;AACIL,4BAAQ,CAAR;AACAD,4BAAQ,QAAR;AACA;AACJ,qBAAKxD,QAAQ2D,SAAR,CAAkBI,UAAvB;AACIN,4BAAQ,CAAR;AACAD,4BAAQ,QAAR;AACA;AACJ;AACI;AAlBR;AAoBA,gBAAIQ,SAAS,0BAA0BP,KAA1B,GAAkC,MAA/C;AACA,gBAAIQ,SAAS/D,GAAGgE,GAAH,CAAOC,GAAP,CAAWH,MAAX,CAAb;AACA,gBAAII,UAAUlE,GAAGmE,YAAH,CAAgBC,QAAhB,CAAyBL,MAAzB,CAAd;;AAEA,gBAAIM,MAAO,IAAIrE,GAAGyC,IAAP,EAAD,CAAgBC,YAAhB,CAA6B1C,GAAG2C,MAAhC,CAAV;AACA0B,gBAAIzB,WAAJ,GAAkB,IAAI5C,GAAG6C,WAAP,CAAmBqB,OAAnB,CAAlB;AACAG,gBAAItB,IAAJ,CAASC,MAAT,GAAkBR,GAAGO,IAArB;AACAsB,gBAAItB,IAAJ,CAASuB,QAAT,CAAkB,GAAlB,EAAsB,GAAtB;AACAD,gBAAItB,IAAJ,CAASwB,OAAT,GAAmB,CAAnB;AACAF,gBAAItB,IAAJ,CAASK,WAAT,CAAqBpD,GAAGqD,CAAH,CAAK,CAAC,GAAN,EAAW,GAAX,CAArB;;AAEA,gBAAImB,MAAO,IAAIxE,GAAGyC,IAAP,EAAD,CAAgBC,YAAhB,CAA6B1C,GAAG2C,MAAhC,CAAV;AACA6B,gBAAI5B,WAAJ,GAAkB,IAAI5C,GAAG6C,WAAP,CAAmBqB,OAAnB,CAAlB;AACAM,gBAAIzB,IAAJ,CAASC,MAAT,GAAkBR,GAAGO,IAArB;AACAyB,gBAAIzB,IAAJ,CAASI,QAAT,GAAoB,GAApB;AACAqB,gBAAIzB,IAAJ,CAASuB,QAAT,CAAkB,GAAlB,EAAsB,GAAtB;AACAE,gBAAIzB,IAAJ,CAASwB,OAAT,GAAmB,CAAnB;AACAC,gBAAIzB,IAAJ,CAASK,WAAT,CAAqBpD,GAAGqD,CAAH,CAAK,GAAL,EAAU,CAAC,GAAX,CAArB;;AAEA,gBAAIlC,MAAMrB,QAAQ2E,cAAR,CAAuB,MAAK3D,QAA5B,CAAV;AACAwC,oBAAQ,oBAAoBA,KAApB,GAA4BnC,GAA5B,GAAkC,MAA1C;AACA,gBAAIuD,UAAU1E,GAAGgE,GAAH,CAAOC,GAAP,CAAWX,KAAX,CAAd;AACA,gBAAIqB,WAAW3E,GAAGmE,YAAH,CAAgBC,QAAhB,CAAyBM,OAAzB,CAAf;;AAEA,gBAAIE,MAAO,IAAI5E,GAAGyC,IAAP,EAAD,CAAgBC,YAAhB,CAA6B1C,GAAG2C,MAAhC,CAAV;AACAiC,gBAAIhC,WAAJ,GAAkB,IAAI5C,GAAG6C,WAAP,CAAmB8B,QAAnB,CAAlB;AACAC,gBAAI7B,IAAJ,CAASC,MAAT,GAAkBR,GAAGO,IAArB;AACA6B,gBAAI7B,IAAJ,CAASwB,OAAT,GAAmB,CAAnB;AACAK,gBAAI7B,IAAJ,CAASK,WAAT,CAAqBpD,GAAGqD,CAAH,CAAK,CAAC,GAAN,EAAW,GAAX,CAArB;;AAEA,gBAAIwB,MAAO,IAAI7E,GAAGyC,IAAP,EAAD,CAAgBC,YAAhB,CAA6B1C,GAAG2C,MAAhC,CAAV;AACAkC,gBAAIjC,WAAJ,GAAkB,IAAI5C,GAAG6C,WAAP,CAAmB8B,QAAnB,CAAlB;AACAE,gBAAI9B,IAAJ,CAASC,MAAT,GAAkBR,GAAGO,IAArB;AACA8B,gBAAI9B,IAAJ,CAASwB,OAAT,GAAmB,CAAnB;AACAM,gBAAI9B,IAAJ,CAASI,QAAT,GAAoB,GAApB;AACA0B,gBAAI9B,IAAJ,CAASK,WAAT,CAAqBpD,GAAGqD,CAAH,CAAK,GAAL,EAAU,CAAC,GAAX,CAArB;;AAEAgB,gBAAItB,IAAJ,CAAS+B,SAAT,CAAmB9E,GAAG+E,MAAH,CAAU,GAAV,CAAnB;AACAP,gBAAIzB,IAAJ,CAAS+B,SAAT,CAAmB9E,GAAG+E,MAAH,CAAU,GAAV,CAAnB;AACAH,gBAAI7B,IAAJ,CAAS+B,SAAT,CAAmB9E,GAAG+E,MAAH,CAAU,GAAV,CAAnB;AACAF,gBAAI9B,IAAJ,CAAS+B,SAAT,CAAmB9E,GAAG+E,MAAH,CAAU,GAAV,CAAnB;;AAEA,kBAAKhC,IAAL,CAAUiC,OAAV,CAAkBC,WAAlB,CAA8B,MAAKC,MAAnC;AACA,kBAAKnC,IAAL,CAAUiC,OAAV,CAAkBC,WAAlB,CAA8B,MAAKE,KAAnC;AACA,kBAAKC,SAAL;AACH,SA3EY,CAAb;AA4EA,aAAKrC,IAAL,CAAU+B,SAAV,CAAoB9E,GAAGqF,QAAH,CAAYrF,GAAGsF,SAAH,CAAa,GAAb,CAAZ,EAA+BhD,MAA/B,CAApB;AAEH,KA3HQ;AA4HLL,oBAAgB,0BAAY;AACxB,YAAIiD,SAAS,IAAIlF,GAAGuF,MAAP,EAAb;AACA,aAAKxC,IAAL,CAAUiC,OAAV,CAAkBQ,QAAlB,CAA2BN,MAA3B,EAAmC,EAAnC;AACA,aAAKA,MAAL,GAAcA,MAAd;AACA,aAAKO,WAAL,GAAmB,CAAnB;AACA,aAAKC,WAAL,GAAmB,KAAnB;;AAEAR,eAAOS,IAAP,GAAc,YAAY;AACtBC,oBAAQC,GAAR,CAAY,mBAAmB,KAAK/D,KAApC;AACA,gBAAI,KAAKA,KAAL,IAAc,KAAKP,uBAAvB,EAAgD;AAC5C,qBAAKuE,mBAAL,CAAyB,CAAzB;AACH,aAFD,MAGK,IAAI,KAAKhE,KAAL,IAAc,KAAKN,yBAAvB,EAAkD;AACnD,oBAAI,KAAKiE,WAAL,IAAoB,KAAK/D,0BAA7B,EAAyD;AACrD,yBAAKoE,mBAAL,CAAyB,CAAC,KAAKnE,0BAAN,GAAmC,KAAK8D,WAAxC,GAAsD,KAAK/D,0BAApF;AACH,iBAFD,MAGK,IAAI,KAAK+D,WAAL,GAAoB,KAAK/D,0BAAL,GAAkC,KAAKE,wBAA/D,EAA0F;AAC3F,wBAAImE,QAAQ,CAAC,KAAKN,WAAL,GAAmB,KAAK/D,0BAAzB,IAAuD,KAAKE,wBAAxE;AACA,yBAAKoE,qBAAL,CAA2BC,KAAKC,GAAL,CAAS,IAAT,EAAe,KAAKrE,wBAAL,IAAiC,IAAIkE,KAArC,CAAf,CAA3B;AACH,iBAHI,MAIA;AACD;AACAH,4BAAQC,GAAR,CAAY,KAAZ;AACA,yBAAKM,kBAAL;AACA,wBAAG,CAAC,KAAKC,OAAT,EAAiB;AACb,6BAAKA,OAAL,GAAe,IAAf;AACA,6BAAK/D,QAAL;AACH;;AAGD;AACA;AACA;AACA;AACA;AACA;AACH;AACD,qBAAKoD,WAAL,GAAmB,KAAKA,WAAL,GAAmB,CAAtC;AACH;AACJ,SAhCa,CAgCZY,IAhCY,CAgCP,IAhCO,CAAd;AAiCH,KApKI;;AAsKLlE,wBAAoB,8BAAY;AAC5B,YAAIgD,QAAQ,IAAInF,GAAGsG,KAAP,EAAZ;AACA,aAAKvD,IAAL,CAAUiC,OAAV,CAAkBQ,QAAlB,CAA2BL,KAA3B,EAAkC,EAAlC;AACA,aAAKA,KAAL,GAAaA,KAAb;AACA,YAAIoB,OAAO,IAAX;AACAvG,WAAGwG,YAAH,CAAgBC,WAAhB,CAA4B;AACxBC,mBAAO1G,GAAG2G,aAAH,CAAiBC,gBADA;AAExBC,0BAAc,sBAAUC,KAAV,EAAiBJ,KAAjB,EAAwB;AAClC1G,mBAAG6F,GAAH,CAAO,8BAAP;AACA,uBAAO,IAAP;AACH,aALuB;AAMxBkB,0BAAc,sBAAUD,KAAV,EAAiBJ,KAAjB,EAAwB;AAClC1G,mBAAG6F,GAAH,CAAO,8BAAP;AACA,oBAAImB,WAAWF,MAAMG,WAAN,EAAf;AACAV,qBAAKtF,QAAL,GAAgB,CAAC+F,SAASE,CAAT,GAAaX,KAAKY,WAAnB,IAAkCZ,KAAKnE,WAAvD;AACAmE,qBAAKtF,QAAL,GAAgBgF,KAAKC,GAAL,CAAS,CAAT,EAAYK,KAAKtF,QAAjB,CAAhB;AACAsF,qBAAKtF,QAAL,GAAgBgF,KAAKmB,GAAL,CAAS,CAAT,EAAYb,KAAKtF,QAAjB,CAAhB;AACA,uBAAO,IAAP;AACH,aAbuB;AAcxBoG,0BAAc,sBAAUP,KAAV,EAAiBJ,KAAjB,EAAwB;AAClC1G,mBAAG6F,GAAH,CAAO,8BAAP;AACA,oBAAIU,KAAKtF,QAAL,IAAiB,CAArB,EAAwB;AACpBsF,yBAAKzE,KAAL,GAAayE,KAAK/E,yBAAlB;AACH;AACJ;;AAnBuB,SAA5B,EAqBG2D,KArBH;AAsBH,KAjMI;;AAmMLjD,wBAAoB,8BAAY;AAC5B,YAAIoF,iBACA,iCACA,8BADA,GAEA,yBAFA,GAGA,0BAHA,GAIA,wBAJA,GAKA,yBALA,GAMA,uBANA,GAOA,uBAPA,GAQA,2BARA,GASA,4BATA,GAWA,eAXA,GAYA,KAZA,GAaA,+CAbA,GAcA,4DAdA,GAgBA,0CAhBA,GAiBA,iCAjBA,GAkBA,yFAlBA,GAmBA,wCAnBA,GAoBA,sCApBA,GAqBA,gCArBA,GAsBA,2CAtBA,GAuBA,kDAvBA,GAwBA,iDAxBA,GAyBA,qDAzBA,GA0BA,eA1BA,GA2BA,QA3BA,GA4BA,yBA5BA,GA6BA,iDA7BA,GA8BA,qCA9BA,GA+BA,4CA/BA,GAgCA,0CAhCA,GAiCA,aAjCA,GAkCA,wDAlCA,GAmCA,6DAnCA,GAoCA,sCApCA,GAqCA,4DArCA,GAsCA,qDAtCA,GAuCA,aAvCA,GAwCA,SAxCA,GAyCA,6BAzCA,GA0CA,6BA1CA,GA2CA,0BA3CA,GA4CA,uBA5CA,GA6CA,qCA7CA,GA8CA,qCA9CA,GA+CA,mDA/CA,GAgDA,mDAhDA,GAiDA,wDAjDA,GAkDA,8CAlDA,GAmDA,6CAnDA,GAoDA,gCApDA,GAqDA,KAtDJ;;AAwDA,YAAIC,mBACA,iCACA,8BADA,GAEA,wBAFA,GAGA,yBAHA,GAIA,uBAJA,GAKA,uBALA,GAMA,2BANA,GAOA,4BAPA,GASA,eATA,GAUA,KAVA,GAWA,+CAXA,GAYA,4DAZA,GAaA,qCAbA,GAcA,0FAdA,GAeA,yCAfA,GAgBA,8BAhBA,GAiBA,qCAjBA,GAkBA,wCAlBA,GAmBA,qCAnBA,GAoBA,qCApBA,GAqBA,sCArBA,GAsBA,mCAtBA,GAuBA,yCAvBA,GAwBA,yCAxBA,GAyBA,+BAzBA,GA0BA,4BA1BA,GA2BA,yCA3BA,GA4BA,6CA5BA,GA6BA,4CA7BA,GA8BA,SA9BA,GA+BA,qCA/BA,GAgCA,qCAhCA,GAiCA,uCAjCA,GAkCA,4BAlCA,GAmCA,2BAnCA,GAoCA,8BApCA,GAqCA,0CArCA,GAsCA,0CAtCA,GAuCA,0CAvCA,GAwCA,wDAxCA,GAyCA,wDAzCA,GA0CA,SA1CA,GA2CA,qCA3CA,GA4CA,+CA5CA,GA6CA,8CA7CA,GA8CA,6CA9CA,GA+CA,SA/CA,GAgDA,8CAhDA,GAiDA,6CAjDA,GAkDA,sDAlDA,GAmDA,KApDJ;;AAsDA,YAAIC,gBACA,OACA,8BADA,GAEA,8BAFA,GAGA,wBAHA,GAIA,yBAJA,GAKA,uBALA,GAMA,uBANA,GAOA,4BAPA,GASA,eATA,GAUA,KAVA,GAWA,+CAXA,GAYA,6DAZA,GAaA,qCAbA,GAcA,0FAdA,GAeA,yCAfA,GAgBA,8CAhBA,GAiBA,6CAjBA,GAkBA,sDAlBA,GAmBA,KApBJ;;AAsBA,YAAIC,gBACA,+BACA,eADA,GAEA,KAFA,GAGA,wBAHA,GAIA,sDAJA,GAKA,KANJ;;AAQA,YAAIC,gBAAgB,KAAKA,aAAL,GAAqB,KAAKC,eAAL,CAAqBL,cAArB,EAAqCG,aAArC,CAAzC;AACA,YAAIG,kBAAkB,KAAKA,eAAL,GAAuB,KAAKD,eAAL,CAAqBJ,gBAArB,EAAuCE,aAAvC,CAA7C;AACA,YAAII,eAAe,KAAKA,YAAL,GAAoB,KAAKF,eAAL,CAAqBH,aAArB,EAAoCC,aAApC,CAAvC;AACA,aAAKC,aAAL,CAAmBI,MAAnB;AACA,aAAKF,eAAL,CAAqBE,MAArB;AACA,aAAKD,YAAL,CAAkBC,MAAlB;;AAEAJ,sBAAcK,UAAd,GAA2BC,GAAGC,kBAAH,CAAsBP,cAAcQ,UAAd,EAAtB,EAAkD,UAAlD,CAA3B;AACAR,sBAAcS,KAAd,GAAsBH,GAAGC,kBAAH,CAAsBP,cAAcQ,UAAd,EAAtB,EAAkD,OAAlD,CAAtB;AACAR,sBAAcU,MAAd,GAAuBJ,GAAGC,kBAAH,CAAsBP,cAAcQ,UAAd,EAAtB,EAAkD,QAAlD,CAAvB;AACAR,sBAAcW,IAAd,GAAqBL,GAAGC,kBAAH,CAAsBP,cAAcQ,UAAd,EAAtB,EAAkD,MAAlD,CAArB;AACAR,sBAAcY,IAAd,GAAqBN,GAAGC,kBAAH,CAAsBP,cAAcQ,UAAd,EAAtB,EAAkD,MAAlD,CAArB;AACAR,sBAAca,MAAd,GAAuBP,GAAGC,kBAAH,CAAsBP,cAAcQ,UAAd,EAAtB,EAAkD,QAAlD,CAAvB;AACAR,sBAAcc,KAAd,GAAsBR,GAAGC,kBAAH,CAAsBP,cAAcQ,UAAd,EAAtB,EAAkD,OAAlD,CAAtB;;AAEAN,wBAAgBG,UAAhB,GAA6BC,GAAGC,kBAAH,CAAsBL,gBAAgBM,UAAhB,EAAtB,EAAoD,UAApD,CAA7B;AACAN,wBAAgBS,IAAhB,GAAuBL,GAAGC,kBAAH,CAAsBL,gBAAgBM,UAAhB,EAAtB,EAAoD,MAApD,CAAvB;AACAN,wBAAgBU,IAAhB,GAAuBN,GAAGC,kBAAH,CAAsBL,gBAAgBM,UAAhB,EAAtB,EAAoD,MAApD,CAAvB;AACAN,wBAAgBW,MAAhB,GAAyBP,GAAGC,kBAAH,CAAsBL,gBAAgBM,UAAhB,EAAtB,EAAoD,QAApD,CAAzB;AACAN,wBAAgBY,KAAhB,GAAwBR,GAAGC,kBAAH,CAAsBL,gBAAgBM,UAAhB,EAAtB,EAAoD,OAApD,CAAxB;;AAEAL,qBAAaQ,IAAb,GAAoBL,GAAGC,kBAAH,CAAsBJ,aAAaK,UAAb,EAAtB,EAAiD,MAAjD,CAApB;AACAL,qBAAaS,IAAb,GAAoBN,GAAGC,kBAAH,CAAsBJ,aAAaK,UAAb,EAAtB,EAAiD,MAAjD,CAApB;AACAL,qBAAaU,MAAb,GAAsBP,GAAGC,kBAAH,CAAsBJ,aAAaK,UAAb,EAAtB,EAAiD,QAAjD,CAAtB;AACAL,qBAAaW,KAAb,GAAqBR,GAAGC,kBAAH,CAAsBJ,aAAaK,UAAb,EAAtB,EAAiD,OAAjD,CAArB;AACH,KAzWI;;AA2WLP,qBAAiB,yBAAUc,OAAV,EAAmBC,OAAnB,EAA4B;AACzC,YAAIC,YAAY3I,GAAG4I,SAAH,CAAaC,oBAAb,CAAkCJ,OAAlC,EAA2CC,OAA3C,CAAhB;AACAC,kBAAUG,IAAV;AACAH,kBAAUI,cAAV;AACA,eAAOJ,SAAP;AACH,KAhXI;;AAkXL7C,yBAAqB,6BAAU3C,QAAV,EAAoB;AACrC,YAAIwF,YAAY,KAAKjB,aAArB;AACAM,WAAGgB,MAAH,CAAUhB,GAAGiB,SAAb;AACAN,kBAAUO,GAAV;AACAP,kBAAUQ,sBAAV;;AAEAR,kBAAUS,qBAAV,CAAgCT,UAAUZ,UAA1C,EAAsD5E,QAAtD;AACAwF,kBAAUS,qBAAV,CAAgCT,UAAUR,KAA1C,EAAiD,KAAKlH,QAAtD;AACA0H,kBAAUS,qBAAV,CAAgCT,UAAUP,MAA1C,EAAkD,KAAKlH,SAAvD;AACAyH,kBAAUS,qBAAV,CAAgCT,UAAUN,IAA1C,EAAgD,KAAKA,IAArD;AACAM,kBAAUS,qBAAV,CAAgCT,UAAUL,IAA1C,EAAgD,KAAKA,IAArD;AACAK,kBAAUS,qBAAV,CAAgCT,UAAUJ,MAA1C,EAAkD,KAAKnG,WAAvD;AACAuG,kBAAUS,qBAAV,CAAgCT,UAAUH,KAA1C,EAAiD,KAAKa,UAAtD;;AAEArB,WAAGsB,WAAH,CAAetB,GAAGuB,UAAlB,EAA8B,KAAKC,YAAnC;AACA,aAAKC,YAAL,CAAkB,KAAKC,aAAvB,EAAsC,KAAKC,aAA3C;AACA3B,WAAGsB,WAAH,CAAetB,GAAGuB,UAAlB,EAA8B,KAAKK,aAAnC;AACA,aAAKH,YAAL,CAAkB,KAAKI,cAAvB,EAAuC,KAAKC,cAA5C;AACA9B,WAAG+B,OAAH,CAAW/B,GAAGiB,SAAd;AACH,KArYI;;AAuYLjD,2BAAuB,+BAAU7C,QAAV,EAAoB;AACvC,YAAIwF,YAAY,KAAKf,eAArB;AACAe,kBAAUO,GAAV;AACAP,kBAAUQ,sBAAV;;AAEAnB,WAAGsB,WAAH,CAAetB,GAAGuB,UAAlB,EAA8B,KAAKK,aAAnC;AACAjB,kBAAUS,qBAAV,CAAgCT,UAAUZ,UAA1C,EAAsD5E,QAAtD;AACAwF,kBAAUS,qBAAV,CAAgCT,UAAUN,IAA1C,EAAgD,KAAKA,IAArD;AACAM,kBAAUS,qBAAV,CAAgCT,UAAUL,IAA1C,EAAgD,KAAKA,IAArD;AACAK,kBAAUS,qBAAV,CAAgCT,UAAUJ,MAA1C,EAAkD,KAAKnG,WAAvD;AACAuG,kBAAUS,qBAAV,CAAgCT,UAAUH,KAA1C,EAAiD,KAAKa,UAAtD;;AAEA,aAAKI,YAAL,CAAkB,KAAKI,cAAvB,EAAuC,KAAKC,cAA5C;AACH,KApZI;;AAsZL3D,wBAAoB,8BAAY;AAC5B,YAAIwC,YAAY,KAAKd,YAArB;AACAc,kBAAUO,GAAV;AACAP,kBAAUQ,sBAAV;;AAEAnB,WAAGsB,WAAH,CAAetB,GAAGuB,UAAlB,EAA8B,KAAKK,aAAnC;AACAjB,kBAAUS,qBAAV,CAAgCT,UAAUN,IAA1C,EAAgD,KAAKA,IAArD;AACAM,kBAAUS,qBAAV,CAAgCT,UAAUL,IAA1C,EAAgD,KAAKA,IAArD;AACAK,kBAAUS,qBAAV,CAAgCT,UAAUJ,MAA1C,EAAkD,KAAKnG,WAAvD;AACAuG,kBAAUS,qBAAV,CAAgCT,UAAUH,KAA1C,EAAiD,KAAKa,UAAtD;AACA,aAAKI,YAAL,CAAkB,KAAKI,cAAvB,EAAuC,KAAKC,cAA5C;AACH,KAjaI;;AAmaLL,kBAAc,sBAAUO,GAAV,EAAeC,GAAf,EAAoB;AAC9B,YAAIC,8BAA8B,CAAlC;AACA,YAAIC,gCAAgC,CAApC;AACAnK,WAAGoK,qBAAH,CAAyBD,gCAAgCD;AACzD;AADA,UAEA,IAAIG,yBAAyB,CAA7B;AACA,YAAIC,2BAA2B,CAA/B;AACAtC,WAAGuC,UAAH,CAAcvC,GAAGwC,YAAjB,EAA+BR,GAA/B;AACAhC,WAAGyC,mBAAH,CAAuBJ,sBAAvB,EAA+C,CAA/C,EAAkDrC,GAAG0C,KAArD,EAA4D,CAA5D,EAA+D,CAA/D,EAAkE,CAAlE;AACA1C,WAAGuC,UAAH,CAAcvC,GAAGwC,YAAjB,EAA+BP,GAA/B;AACAjC,WAAGyC,mBAAH,CAAuBH,wBAAvB,EAAiD,CAAjD,EAAoDtC,GAAG0C,KAAvD,EAA8D,CAA9D,EAAiE,CAAjE,EAAoE,CAApE;AACA1C,WAAG2C,UAAH,CAAc3C,GAAG4C,SAAjB,EAA4B,CAA5B,EAA+B,KAAKC,SAApC;AACA7C,WAAGuC,UAAH,CAAcvC,GAAGwC,YAAjB,EAA+B,CAA/B;AACH,KAhbI;;AAkbLxI,qBAAiB,yBAAU8I,MAAV,EAAkB;AAC/B,YAAIC,OAAO,EAAX,CAD+B,CAChB;AACf,YAAIC,QAAQ,IAAIC,KAAJ,EAAZ,CAF+B,CAEN;AACzB,YAAIC,OAAO,IAAID,KAAJ,EAAX,CAH+B,CAGP;AACxB,YAAIE,KAAK,KAAK/I,WAAL,GAAmB2I,IAA5B;AACA,YAAIK,KAAK,KAAK/B,UAAd;;AAEA;AACA,aAAK,IAAIgC,IAAI,CAAb,EAAgBA,KAAKN,IAArB,EAA2BM,GAA3B,EAAgC;AAC5B,gBAAIC,IAAI,CAAR;AACA,gBAAIpE,IAAI,CAACmE,IAAI,CAAL,IAAUF,EAAlB;AACA,gBAAII,OAAO,IAAX;AACA,gBAAIT,MAAJ,EAAY;AACRS,uBAAO,IAAIN,KAAJ,CAAUK,CAAV,EAAapE,CAAb,EAAgBoE,IAAIF,EAApB,EAAwBlE,CAAxB,EAA2BoE,CAA3B,EAA8BpE,IAAIiE,EAAlC,EAAsCG,IAAIF,EAA1C,EAA8ClE,CAA9C,EAAiDoE,IAAIF,EAArD,EAAyDlE,IAAIiE,EAA7D,EAAiEG,CAAjE,EAAoEpE,IAAIiE,EAAxE,CAAP;AACH,aAFD,MAGK;AACDI,uBAAO,IAAIN,KAAJ,CAAUK,CAAV,EAAapE,CAAb,EAAgBoE,CAAhB,EAAmBpE,IAAIiE,EAAvB,EAA2BG,IAAIF,EAA/B,EAAmClE,CAAnC,EAAsCoE,IAAIF,EAA1C,EAA8ClE,CAA9C,EAAiDoE,CAAjD,EAAoDpE,IAAIiE,EAAxD,EAA4DG,IAAIF,EAAhE,EAAoElE,IAAIiE,EAAxE,CAAP;AACH;AACD,iBAAK,IAAIK,IAAI,CAAb,EAAgBA,KAAK,CAArB,EAAwBA,GAAxB,EAA6B;AACzB,oBAAIC,QAAQF,KAAKC,IAAI,CAAT,CAAZ;AACA,oBAAIE,QAAQH,KAAKC,IAAI,CAAJ,GAAQ,CAAb,CAAZ;AACA,oBAAIG,OAAO,IAAID,QAAQ,KAAKtJ,WAA5B;AACA,oBAAIwJ,OAAOH,QAAQ,KAAKpC,UAAxB;AACA6B,qBAAKW,IAAL,CAAU5F,KAAKC,GAAL,CAAS,CAAT,EAAYyF,IAAZ,CAAV;AACAT,qBAAKW,IAAL,CAAU5F,KAAKC,GAAL,CAAS,CAAT,EAAY0F,IAAZ,CAAV;AACH;AACD,iBAAK,IAAIE,CAAT,IAAcP,IAAd,EAAoB;AAChBP,sBAAMa,IAAN,CAAWN,KAAKO,CAAL,CAAX;AACH;AACJ;AACD,YAAIC,YAAY/D,GAAGgE,YAAH,EAAhB;AACAhE,WAAGuC,UAAH,CAAcvC,GAAGwC,YAAjB,EAA+BuB,SAA/B;AACA/D,WAAGiE,UAAH,CAAcjE,GAAGwC,YAAjB,EAA+B,IAAI0B,YAAJ,CAAiBlB,KAAjB,CAA/B,EAAwDhD,GAAGmE,WAA3D;AACAnE,WAAGuC,UAAH,CAAcvC,GAAGwC,YAAjB,EAA+B,IAA/B;AACA,aAAKK,SAAL,GAAiBG,MAAMoB,MAAN,GAAe,CAAhC;;AAEA,YAAIC,YAAYrE,GAAGgE,YAAH,EAAhB;AACAhE,WAAGuC,UAAH,CAAcvC,GAAGwC,YAAjB,EAA+B6B,SAA/B;AACArE,WAAGiE,UAAH,CAAcjE,GAAGwC,YAAjB,EAA+B,IAAI0B,YAAJ,CAAiBhB,IAAjB,CAA/B,EAAuDlD,GAAGmE,WAA1D;AACAnE,WAAGuC,UAAH,CAAcvC,GAAGwC,YAAjB,EAA+B,IAA/B;AACA,YAAIM,MAAJ,EAAY;AACR,iBAAKpB,aAAL,GAAqBqC,UAAUO,SAA/B;AACA,iBAAK3C,aAAL,GAAqB0C,UAAUC,SAA/B;AACH,SAHD,MAIK;AACD,iBAAKzC,cAAL,GAAsBkC,UAAUO,SAAhC;AACA,iBAAKxC,cAAL,GAAsBuC,UAAUC,SAAhC;AACH;AACJ,KAleI;;AAoeLvK,sBAAkB,4BAAY;AAC1B,YAAIgC,SAAS/D,GAAGgE,GAAH,CAAOC,GAAP,CAAW,KAAK5C,MAAhB,CAAb;AACA,aAAKyB,WAAL,GAAmB9C,GAAGmE,YAAH,CAAgBC,QAAhB,CAAyBL,MAAzB,CAAnB;AACA;AACA,aAAKjB,WAAL,CAAiBgF,MAAjB;;AAEA/D,iBAAS/D,GAAGgE,GAAH,CAAOC,GAAP,CAAW,KAAK7C,MAAhB,CAAT;AACA,aAAKmL,UAAL,GAAkBvM,GAAGmE,YAAH,CAAgBC,QAAhB,CAAyBL,MAAzB,CAAlB;AACA;AACA,aAAKwI,UAAL,CAAgBzE,MAAhB;;AAEA,YAAI0E,YAAY,KAAKD,UAAL,CAAgBE,cAAhB,EAAhB;AACA,aAAKpD,UAAL,GAAkBmD,UAAUE,MAA5B;AACA,aAAKtK,WAAL,GAAmBoK,UAAUG,KAA7B;;AAEA,aAAKtE,IAAL,GAAY,KAAKtH,IAAL,GAAY,KAAKsI,UAAL,GAAkB,CAA1C;AACA,aAAKf,IAAL,GAAY,KAAKtH,IAAL,GAAY,KAAKoB,WAAL,GAAmB,CAA3C;AACA,aAAKoH,YAAL,GAAoB,KAAK+C,UAAL,CAAgBK,OAAhB,EAApB;AACA,aAAKhD,aAAL,GAAqB,KAAK9G,WAAL,CAAiB8J,OAAjB,EAArB;;AAEA,aAAKzF,WAAL,GAAmBnH,GAAG6M,OAAH,CAAWH,MAAX,GAAoB,CAApB,GAAwB,KAAK1L,IAA7B,GAAoC,KAAKoB,WAAL,GAAmB,CAA1E;AACH,KAzfI;;AA2fL;AACAgD,eAAW,qBAAY;AACnBQ,gBAAQC,GAAR,CAAY,WAAZ;AACAmC,WAAG8E,aAAH,CAAiB,KAAKpD,aAAtB;AACA1B,WAAG8E,aAAH,CAAiB,KAAKnD,aAAtB;AACA3B,WAAG8E,aAAH,CAAiB,KAAKjD,cAAtB;AACA7B,WAAG8E,aAAH,CAAiB,KAAKhD,cAAtB;AACA,aAAKpC,aAAL,CAAmBqF,OAAnB;AACA,aAAKnF,eAAL,CAAqBmF,OAArB;AACA,aAAKlF,YAAL,CAAkBkF,OAAlB;AACA,aAAKR,UAAL,CAAgBQ,OAAhB;AACA,aAAKjK,WAAL,CAAiBiK,OAAjB;AACH;AAvgBI,CAAT","file":"unknown","sourceRoot":"../../../../assets/Script","sourcesContent":["var MyUtils = require(\"MyUtils\");\ncc.Class({\n    extends: cc.Component,\n\n    properties: {\n        label: {\n            default: null,\n            type: cc.Label\n        },\n        // defaults, set visually when attaching this script to the Canvas\n        text: 'Hello, World!',\n    },\n\n    onLoad: function () {\n        this.label.string = this.text;\n        this.__initCfg(13);\n    },\n\n    __initCfg: function (cardNum) {\n        this._cardNum = cardNum;\n        this.posX = 0;\n        this.posY = -60;\n        this.ratioVal = 0;\n        this.radiusVal = 0;\n        var num = 0;\n        this.szBack = \"resources/card/card-back.png\";\n        this.szFont = \"resources/card/\" + MyUtils.getCardNameByCompsiteNum(cardNum) + \".png\";\n        this.RubCardLayer_State_Move = 0;\n        this.RubCardLayer_State_Smooth = 1;\n        var RubCardLayer_Pai = 3.141592\n        this.RubCardLayer_RotationFrame = 10\n        this.RubCardLayer_RotationAnger = RubCardLayer_Pai / 3\n        this.RubCardLayer_SmoothFrame = 10\n        this.RubCardLayer_SmoothAnger = RubCardLayer_Pai / 6\n\n        this.state = this.RubCardLayer_State_Move;\n\n        this.__createTextures();\n        this.__initTexAndPos(true);\n        this.__initTexAndPos(false);\n        this.__createGlNode();\n        this.__createAllProgram();\n        this.__registTouchEvent()\n        this.radiusVal = this.pokerHeight / 10;\n    },\nopenCard : function () {\n    var action = cc.callFunc(() => {\n        var sp = (new cc.Node()).addComponent(cc.Sprite);\n        sp.spriteFrame = new cc.SpriteFrame(this.frontSprite);\n        sp.node.parent = this.node;\n        sp.node.setContentSize(cc.size(532, 820));\n        sp.node.rotation = 90;\n        sp.node.setPosition(cc.p(this.posX, this.posY));\n\n        var yanse = \"\";\n        var nType = 0;\n        switch (MyUtils.GetType(this._cardNum)) {\n            case MyUtils.eCardType.eCard_Diamond:\n                nType = 4;\n                yanse = \"red_\";\n                break;\n            case MyUtils.eCardType.eCard_Heart:\n                nType = 2;\n                yanse = \"red_\";\n                break;\n            case MyUtils.eCardType.eCard_Sword:\n                nType = 1;\n                yanse = \"black_\";\n                break;\n            case MyUtils.eCardType.eCard_Club:\n                nType = 3;\n                yanse = \"black_\";\n                break;\n            default:\n                break;\n        }\n        var huashe = \"resources/card/color_\" + nType + \".png\";\n        var imgUrl = cc.url.raw(huashe);\n        var texture = cc.textureCache.addImage(imgUrl);\n\n        var hs1 = (new cc.Node()).addComponent(cc.Sprite);\n        hs1.spriteFrame = new cc.SpriteFrame(texture);\n        hs1.node.parent = sp.node;\n        hs1.node.setScale(0.5,0.5);\n        hs1.node.opacity = 0;\n        hs1.node.setPosition(cc.p(-215, 260));\n\n        var hs2 = (new cc.Node()).addComponent(cc.Sprite);\n        hs2.spriteFrame = new cc.SpriteFrame(texture);\n        hs2.node.parent = sp.node;\n        hs2.node.rotation = 180;\n        hs2.node.setScale(0.5,0.5);\n        hs2.node.opacity = 0;\n        hs2.node.setPosition(cc.p(215, -260));\n\n        var num = MyUtils.GetCardFaceNum(this._cardNum);\n        yanse = \"resources/card/\" + yanse + num + \".png\";\n        var imgUrl1 = cc.url.raw(yanse);\n        var texture1 = cc.textureCache.addImage(imgUrl1);\n\n        var ys1 = (new cc.Node()).addComponent(cc.Sprite);\n        ys1.spriteFrame = new cc.SpriteFrame(texture1);\n        ys1.node.parent = sp.node;\n        ys1.node.opacity = 0;\n        ys1.node.setPosition(cc.p(-215, 350));\n\n        var ys2 = (new cc.Node()).addComponent(cc.Sprite);\n        ys2.spriteFrame = new cc.SpriteFrame(texture1);\n        ys2.node.parent = sp.node;\n        ys2.node.opacity = 0;\n        ys2.node.rotation = 180;\n        ys2.node.setPosition(cc.p(215, -350));\n\n        hs1.node.runAction(cc.fadeIn(0.5));\n        hs2.node.runAction(cc.fadeIn(0.5));\n        ys1.node.runAction(cc.fadeIn(0.5));\n        ys2.node.runAction(cc.fadeIn(0.5));\n\n        this.node._sgNode.removeChild(this.glnode);\n        this.node._sgNode.removeChild(this.layer);\n        this.onDestroy()\n    });\n    this.node.runAction(cc.sequence(cc.delayTime(0.1), action));\n\n},\n    __createGlNode: function () {\n        var glnode = new cc.GLNode();\n        this.node._sgNode.addChild(glnode, 10);\n        this.glnode = glnode;\n        this.smoothFrame = 1;\n        this.isCreateNum = false;\n\n        glnode.draw = function () {\n            console.log(\"glnode.draw : \" + this.state);\n            if (this.state == this.RubCardLayer_State_Move) {\n                this.__drawByMoveProgram(0);\n            }\n            else if (this.state == this.RubCardLayer_State_Smooth) {\n                if (this.smoothFrame <= this.RubCardLayer_RotationFrame) {\n                    this.__drawByMoveProgram(-this.RubCardLayer_RotationAnger * this.smoothFrame / this.RubCardLayer_RotationFrame);\n                }\n                else if (this.smoothFrame < (this.RubCardLayer_RotationFrame + this.RubCardLayer_SmoothFrame)) {\n                    var scale = (this.smoothFrame - this.RubCardLayer_RotationFrame) / this.RubCardLayer_SmoothFrame;\n                    this.__drawBySmoothProgram(Math.max(0.01, this.RubCardLayer_SmoothAnger * (1 - scale)))\n                }\n                else {\n                    //第一次到这里就铺平了\n                    console.log(\"平铺了\");\n                    this.__drawByEndProgram();\n                    if(!this._isopen){\n                        this._isopen = true;\n                        this.openCard();\n                    }\n      \n\n                    // var self = this\n                    // setTimeout(function(){\n                    //     self.node._sgNode.removeChild(self.glnode);\n                    //     self.node._sgNode.removeChild(self.layer);\n                    //     self.onDestroy()\n                    // },2000);\n                }\n                this.smoothFrame = this.smoothFrame + 1\n            }\n        }.bind(this);\n    },\n\n    __registTouchEvent: function () {\n        var layer = new cc.Layer();\n        this.node._sgNode.addChild(layer, 10);\n        this.layer = layer\n        var self = this;\n        cc.eventManager.addListener({\n            event: cc.EventListener.TOUCH_ONE_BY_ONE,\n            onTouchBegan: function (touch, event) {\n                cc.log(\"page view touch onTouchBegan\");\n                return true;\n            },\n            onTouchMoved: function (touch, event) {\n                cc.log(\"page view touch onTouchMoved\");\n                var location = touch.getLocation();\n                self.ratioVal = (location.y - self.touchStartY) / self.pokerHeight;\n                self.ratioVal = Math.max(0, self.ratioVal);\n                self.ratioVal = Math.min(1, self.ratioVal);\n                return true;\n            },\n            onTouchEnded: function (touch, event) {\n                cc.log(\"page view touch onTouchEnded\");\n                if (self.ratioVal >= 1) {\n                    self.state = self.RubCardLayer_State_Smooth;\n                }\n            },\n\n        }, layer);\n    },\n\n    __createAllProgram: function () {\n        var moveVertSource =\n            \"attribute vec2 a_position;\\n\" +\n            \"attribute vec2 a_texCoord;\\n\" +\n            \"uniform float ratio; \\n\" +\n            \"uniform float radius; \\n\" +\n            \"uniform float width;\\n\" +\n            \"uniform float height;\\n\" +\n            \"uniform float offx;\\n\" +\n            \"uniform float offy;\\n\" +\n            \"uniform float rotation;\\n\" +\n            \"varying vec2 v_texCoord;\\n\" +\n\n            \"void main()\\n\" +\n            \"{\\n\" +\n            \"   vec4 tmp_pos = vec4(0.0, 0.0, 0.0, 0.0);\\n\" +\n            \"   tmp_pos = vec4(a_position.x, a_position.y, 0.0, 1.0);\\n\" +\n\n            \"   float halfPeri = radius * 3.14159; \\n\" +\n            \"   float hr = height * ratio;\\n\" +\n            \"   if(tmp_pos.x < 0.0 || tmp_pos.x > width || tmp_pos.y < 0.0 || tmp_pos.y > height){\\n\" +\n            \"   tmp_pos.x = 0.0;tmp_pos.y = 0.0;}\\n\" +\n            \"   if(hr > 0.0 && hr <= halfPeri){\\n\" +\n            \"         if(tmp_pos.y < hr){\\n\" +\n            \"               float rad = hr/ 3.14159;\\n\" +\n            \"               float arc = (hr-tmp_pos.y)/rad;\\n\" +\n            \"               tmp_pos.y = hr - sin(arc)*rad;\\n\" +\n            \"               tmp_pos.z = rad * (1.0-cos(arc)); \\n\" +\n            \"          }\\n\" +\n            \"   }\\n\" +\n            \"   if(hr > halfPeri){\\n\" +\n            \"        float straight = (hr - halfPeri)/2.0;\\n\" +\n            \"        if(tmp_pos.y < straight){\\n\" +\n            \"            tmp_pos.y = hr  - tmp_pos.y;\\n\" +\n            \"            tmp_pos.z = radius * 2.0; \\n\" +\n            \"        }\\n\" +\n            \"        else if(tmp_pos.y < (straight + halfPeri)) {\\n\" +\n            \"            float dy = halfPeri - (tmp_pos.y - straight);\\n\" +\n            \"            float arc = dy/radius;\\n\" +\n            \"            tmp_pos.y = hr - straight - sin(arc)*radius;\\n\" +\n            \"            tmp_pos.z = radius * (1.0-cos(arc)); \\n\" +\n            \"        }\\n\" +\n            \"    }\\n\" +\n            \"    float y1 = tmp_pos.y;\\n\" +\n            \"    float z1 = tmp_pos.z;\\n\" +\n            \"    float y2 = height;\\n\" +\n            \"    float z2 = 0.0;\\n\" +\n            \"    float sinRat = sin(rotation);\\n\" +\n            \"    float cosRat = cos(rotation);\\n\" +\n            \"    tmp_pos.y=(y1-y2)*cosRat-(z1-z2)*sinRat+y2;\\n\" +\n            \"    tmp_pos.z=(z1-z2)*cosRat+(y1-y2)*sinRat+z2;\\n\" +\n            \"    tmp_pos.y = tmp_pos.y - height/2.0*(1.0-cosRat);\\n\" +\n            \"    tmp_pos += vec4(offx, offy, 0.0, 0.0);\\n\" +\n            \"    gl_Position = CC_MVPMatrix * tmp_pos;\\n\" +\n            \"    v_texCoord = a_texCoord;\\n\" +\n            \"}\\n\";\n\n        var smoothVertSource =\n            \"attribute vec2 a_position;\\n\" +\n            \"attribute vec2 a_texCoord;\\n\" +\n            \"uniform float width;\\n\" +\n            \"uniform float height;\\n\" +\n            \"uniform float offx;\\n\" +\n            \"uniform float offy;\\n\" +\n            \"uniform float rotation;\\n\" +\n            \"varying vec2 v_texCoord;\\n\" +\n\n            \"void main()\\n\" +\n            \"{\\n\" +\n            \"   vec4 tmp_pos = vec4(0.0, 0.0, 0.0, 0.0);\\n\" +\n            \"   tmp_pos = vec4(a_position.x, a_position.y, 0.0, 1.0);\\n\" +\n            \"   tmp_pos.x = width - tmp_pos.x;\\n\" +\n            \"    if(tmp_pos.x < 0.0 || tmp_pos.x > width || tmp_pos.y < 0.0 || tmp_pos.y > height){\\n\" +\n            \"    tmp_pos.x = 0.0;tmp_pos.y = 0.0;}\\n\" +\n            \"    float cl = height/5.0;\\n\" +\n            \"    float sl = (height - cl)/2.0;\\n\" +\n            \"    float radii = (cl/rotation)/2.0;\\n\" +\n            \"    float sinRot = sin(rotation);\\n\" +\n            \"    float cosRot = cos(rotation);\\n\" +\n            \"    float distance = radii*sinRot;\\n\" +\n            \"    float centerY = height/2.0;\\n\" +\n            \"    float poxY1 = centerY - distance;\\n\" +\n            \"    float poxY2 = centerY + distance;\\n\" +\n            \"    float posZ = sl*sinRot;\\n\" +\n            \"    if(tmp_pos.y <= sl){\\n\" +\n            \"       float length = sl - tmp_pos.y;\\n\" +\n            \"       tmp_pos.y = poxY1 - length*cosRot;\\n\" +\n            \"       tmp_pos.z = posZ - length*sinRot;\\n\" +\n            \"    }\\n\" +\n            \"    else if(tmp_pos.y < (sl+cl)){\\n\" +\n            \"       float el = tmp_pos.y - sl;\\n\" +\n            \"       float rotation2 = -el/radii;\\n\" +\n            \"       float x1 = poxY1;\\n\" +\n            \"       float y1 = posZ;\\n\" +\n            \"       float x2 = centerY;\\n\" +\n            \"       float y2 = posZ - radii*cosRot;\\n\" +\n            \"       float sinRot2 = sin(rotation2);\\n\" +\n            \"       float cosRot2 = cos(rotation2);\\n\" +\n            \"       tmp_pos.y=(x1-x2)*cosRot2-(y1-y2)*sinRot2+x2;\\n\" +\n            \"       tmp_pos.z=(y1-y2)*cosRot2+(x1-x2)*sinRot2+y2;\\n\" +\n            \"    }\\n\" +\n            \"    else if(tmp_pos.y <= height){\\n\" +\n            \"        float length = tmp_pos.y - cl - sl;\\n\" +\n            \"        tmp_pos.y = poxY2 + length*cosRot;\\n\" +\n            \"        tmp_pos.z = posZ - length*sinRot;\\n\" +\n            \"    }\\n\" +\n            \"    tmp_pos += vec4(offx, offy, 0.0, 0.0);\\n\" +\n            \"    gl_Position = CC_MVPMatrix * tmp_pos;\\n\" +\n            \"    v_texCoord = vec2(a_texCoord.x, a_texCoord.y);\\n\" +\n            \"}\\n\";\n\n        var endVertSource =\n            \"\\n\" +\n            \"attribute vec2 a_position;\\n\" +\n            \"attribute vec2 a_texCoord;\\n\" +\n            \"uniform float width;\\n\" +\n            \"uniform float height;\\n\" +\n            \"uniform float offx;\\n\" +\n            \"uniform float offy;\\n\" +\n            \"varying vec2 v_texCoord;\\n\" +\n\n            \"void main()\\n\" +\n            \"{\\n\" +\n            \"   vec4 tmp_pos = vec4(0.0, 0.0, 0.0, 0.0);\\n\" +\n            \"   tmp_pos = vec4(a_position.x, a_position.y , 0.0, 1.0);\\n\" +\n            \"   tmp_pos.x = width - tmp_pos.x;\\n\" +\n            \"    if(tmp_pos.x < 0.0 || tmp_pos.x > width || tmp_pos.y < 0.0 || tmp_pos.y > height){\\n\" +\n            \"    tmp_pos.x = 0.0;tmp_pos.y = 0.0;}\\n\" +\n            \"    tmp_pos += vec4(offx, offy, 0.0, 0.0);\\n\" +\n            \"    gl_Position = CC_MVPMatrix * tmp_pos;\\n\" +\n            \"    v_texCoord = vec2(a_texCoord.x, a_texCoord.y);\\n\" +\n            \"}\\n\";\n\n        var strFragSource =\n            \"varying vec2 v_texCoord;\\n\" +\n            \"void main()\\n\" +\n            \"{\\n\" +\n            \"//TODO, 这里可以做些片段着色特效\\n\" +\n            \"gl_FragColor = texture2D(CC_Texture0, v_texCoord);\\n\" +\n            \"}\\n\";\n\n        var moveGlProgram = this.moveGlProgram = this.__createProgram(moveVertSource, strFragSource);\n        var smoothGlProgram = this.smoothGlProgram = this.__createProgram(smoothVertSource, strFragSource);\n        var endGlProgram = this.endGlProgram = this.__createProgram(endVertSource, strFragSource);\n        this.moveGlProgram.retain();\n        this.smoothGlProgram.retain();\n        this.endGlProgram.retain();\n\n        moveGlProgram.rotationLc = gl.getUniformLocation(moveGlProgram.getProgram(), \"rotation\");\n        moveGlProgram.ratio = gl.getUniformLocation(moveGlProgram.getProgram(), \"ratio\");\n        moveGlProgram.radius = gl.getUniformLocation(moveGlProgram.getProgram(), \"radius\");\n        moveGlProgram.offx = gl.getUniformLocation(moveGlProgram.getProgram(), \"offx\");\n        moveGlProgram.offy = gl.getUniformLocation(moveGlProgram.getProgram(), \"offy\");\n        moveGlProgram.Height = gl.getUniformLocation(moveGlProgram.getProgram(), \"height\");\n        moveGlProgram.Width = gl.getUniformLocation(moveGlProgram.getProgram(), \"width\");\n\n        smoothGlProgram.rotationLc = gl.getUniformLocation(smoothGlProgram.getProgram(), \"rotation\")\n        smoothGlProgram.offx = gl.getUniformLocation(smoothGlProgram.getProgram(), \"offx\")\n        smoothGlProgram.offy = gl.getUniformLocation(smoothGlProgram.getProgram(), \"offy\")\n        smoothGlProgram.Height = gl.getUniformLocation(smoothGlProgram.getProgram(), \"height\")\n        smoothGlProgram.Width = gl.getUniformLocation(smoothGlProgram.getProgram(), \"width\");\n\n        endGlProgram.offx = gl.getUniformLocation(endGlProgram.getProgram(), \"offx\");\n        endGlProgram.offy = gl.getUniformLocation(endGlProgram.getProgram(), \"offy\");\n        endGlProgram.Height = gl.getUniformLocation(endGlProgram.getProgram(), \"height\")\n        endGlProgram.Width = gl.getUniformLocation(endGlProgram.getProgram(), \"width\");\n    },\n\n    __createProgram: function (vsource, fsource) {\n        var glProgram = cc.GLProgram.createWithByteArrays(vsource, fsource)\n        glProgram.link();\n        glProgram.updateUniforms()\n        return glProgram\n    },\n\n    __drawByMoveProgram: function (rotation) {\n        var glProgram = this.moveGlProgram;\n        gl.enable(gl.CULL_FACE);\n        glProgram.use();\n        glProgram.setUniformsForBuiltins();\n\n        glProgram.setUniformLocationF32(glProgram.rotationLc, rotation);\n        glProgram.setUniformLocationF32(glProgram.ratio, this.ratioVal);\n        glProgram.setUniformLocationF32(glProgram.radius, this.radiusVal);\n        glProgram.setUniformLocationF32(glProgram.offx, this.offx);\n        glProgram.setUniformLocationF32(glProgram.offy, this.offy);\n        glProgram.setUniformLocationF32(glProgram.Height, this.pokerHeight);\n        glProgram.setUniformLocationF32(glProgram.Width, this.pokerWidth);\n\n        gl.bindTexture(gl.TEXTURE_2D, this.backSpriteId);\n        this.__drawArrays(this.backPosBuffer, this.backTexBuffer);\n        gl.bindTexture(gl.TEXTURE_2D, this.frontSpriteId);\n        this.__drawArrays(this.frontPosBuffer, this.frontTexBuffer);\n        gl.disable(gl.CULL_FACE);\n    },\n\n    __drawBySmoothProgram: function (rotation) {\n        var glProgram = this.smoothGlProgram\n        glProgram.use();\n        glProgram.setUniformsForBuiltins();\n\n        gl.bindTexture(gl.TEXTURE_2D, this.frontSpriteId);\n        glProgram.setUniformLocationF32(glProgram.rotationLc, rotation)\n        glProgram.setUniformLocationF32(glProgram.offx, this.offx)\n        glProgram.setUniformLocationF32(glProgram.offy, this.offy)\n        glProgram.setUniformLocationF32(glProgram.Height, this.pokerHeight)\n        glProgram.setUniformLocationF32(glProgram.Width, this.pokerWidth);\n\n        this.__drawArrays(this.frontPosBuffer, this.frontTexBuffer)\n    },\n\n    __drawByEndProgram: function () {\n        var glProgram = this.endGlProgram;\n        glProgram.use();\n        glProgram.setUniformsForBuiltins();\n\n        gl.bindTexture(gl.TEXTURE_2D, this.frontSpriteId);\n        glProgram.setUniformLocationF32(glProgram.offx, this.offx);\n        glProgram.setUniformLocationF32(glProgram.offy, this.offy);\n        glProgram.setUniformLocationF32(glProgram.Height, this.pokerHeight)\n        glProgram.setUniformLocationF32(glProgram.Width, this.pokerWidth);\n        this.__drawArrays(this.frontPosBuffer, this.frontTexBuffer);\n    },\n\n    __drawArrays: function (pos, tex) {\n        var VERTEX_ATTRIB_FLAG_POSITION = 1\n        var VERTEX_ATTRIB_FLAG_TEX_COORDS = 4\n        cc.glEnableVertexAttribs(VERTEX_ATTRIB_FLAG_TEX_COORDS | VERTEX_ATTRIB_FLAG_POSITION)\n        //console.log('gl.FLOAT='+gl.FLOAT);\n        var VERTEX_ATTRIB_POSITION = 0;\n        var VERTEX_ATTRIB_TEX_COORDS = 2;\n        gl.bindBuffer(gl.ARRAY_BUFFER, pos)\n        gl.vertexAttribPointer(VERTEX_ATTRIB_POSITION, 2, gl.FLOAT, 0, 0, 0)\n        gl.bindBuffer(gl.ARRAY_BUFFER, tex)\n        gl.vertexAttribPointer(VERTEX_ATTRIB_TEX_COORDS, 2, gl.FLOAT, 0, 0, 0)\n        gl.drawArrays(gl.TRIANGLES, 0, this.posTexNum)\n        gl.bindBuffer(gl.ARRAY_BUFFER, 0)\n    },\n\n    __initTexAndPos: function (isBack) {\n        var nDiv = 20; //将宽分成100份\n        var verts = new Array(); //位置坐标\n        var texs = new Array(); //纹理坐标\n        var dh = this.pokerHeight / nDiv;\n        var dw = this.pokerWidth;\n\n        //计算顶点位置\n        for (var c = 1; c <= nDiv; c++) {\n            var x = 0;\n            var y = (c - 1) * dh;\n            var quad = null;\n            if (isBack) {\n                quad = new Array(x, y, x + dw, y, x, y + dh, x + dw, y, x + dw, y + dh, x, y + dh);\n            }\n            else {\n                quad = new Array(x, y, x, y + dh, x + dw, y, x + dw, y, x, y + dh, x + dw, y + dh);\n            };\n            for (var i = 0; i <= 5; i++) {\n                var quadX = quad[i * 2]\n                var quadY = quad[i * 2 + 1]\n                var numX = 1 - quadY / this.pokerHeight\n                var numY = quadX / this.pokerWidth\n                texs.push(Math.max(0, numX));\n                texs.push(Math.max(0, numY));\n            };\n            for (var k in quad) {\n                verts.push(quad[k]);\n            };\n        }\n        var posBuffer = gl.createBuffer();\n        gl.bindBuffer(gl.ARRAY_BUFFER, posBuffer);\n        gl.bufferData(gl.ARRAY_BUFFER, new Float32Array(verts), gl.STATIC_DRAW);\n        gl.bindBuffer(gl.ARRAY_BUFFER, null);\n        this.posTexNum = verts.length / 2;\n\n        var texBuffer = gl.createBuffer();\n        gl.bindBuffer(gl.ARRAY_BUFFER, texBuffer);\n        gl.bufferData(gl.ARRAY_BUFFER, new Float32Array(texs), gl.STATIC_DRAW);\n        gl.bindBuffer(gl.ARRAY_BUFFER, null);\n        if (isBack) {\n            this.backPosBuffer = posBuffer.buffer_id;\n            this.backTexBuffer = texBuffer.buffer_id;\n        }\n        else {\n            this.frontPosBuffer = posBuffer.buffer_id;\n            this.frontTexBuffer = texBuffer.buffer_id;\n        }\n    },\n\n    __createTextures: function () {\n        var imgUrl = cc.url.raw(this.szFont);\n        this.frontSprite = cc.textureCache.addImage(imgUrl);\n        //this.frontSprite.setContentSize(cc.size(472,680));\n        this.frontSprite.retain();\n\n        imgUrl = cc.url.raw(this.szBack);\n        this.backSprite = cc.textureCache.addImage(imgUrl);\n        //this.backSprite.setContentSize(cc.size(472,680));\n        this.backSprite.retain();\n\n        var pokerSize = this.backSprite.getContentSize();\n        this.pokerWidth = pokerSize.height\n        this.pokerHeight = pokerSize.width\n\n        this.offx = this.posX - this.pokerWidth / 2;\n        this.offy = this.posY - this.pokerHeight / 2;\n        this.backSpriteId = this.backSprite.getName()\n        this.frontSpriteId = this.frontSprite.getName()\n\n        this.touchStartY = cc.winSize.height / 2 + this.posY - this.pokerHeight / 2;\n    },\n\n    //结束需要移除\n    onDestroy: function () {\n        console.log(\"onDestroy\");\n        gl._deleteBuffer(this.backPosBuffer)\n        gl._deleteBuffer(this.backTexBuffer)\n        gl._deleteBuffer(this.frontPosBuffer)\n        gl._deleteBuffer(this.frontTexBuffer)\n        this.moveGlProgram.release();\n        this.smoothGlProgram.release();\n        this.endGlProgram.release();\n        this.backSprite.release();\n        this.frontSprite.release();\n    },\n});\n\n"]}