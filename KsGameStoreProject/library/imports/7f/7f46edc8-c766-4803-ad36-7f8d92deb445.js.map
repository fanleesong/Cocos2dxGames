{"version":3,"sources":["../../../../../../../../assets/scripts/GameModule/Base/Module/View/assets/scripts/GameModule/Base/Module/View/Setting.js"],"names":["cc","Class","extends","Component","properties","buttonSfx","AudioClip","_listenerId","_currentBgmCircleState","_currentSoundCircleState","bgmOpenPoint","p","bgmClosePoint","sfxOpenPoint","sfxClosePoint","onLoad","_registerTouchEvent","_initBtnPosition","closeBtn","find","node","bgmBtn","soundBtn","on","ev","isSoundOpen","ss","localStorage","userInfoCache","userId","audioUtil","playSfx","layoutNode","runAction","sequence","scaleTo","callFunc","destroy","targetPos","_openBgm","x","y","_closeBgm","moveTo","_openSound","_closeSound","setScale","EaseBounceOut","create","setBgmState","resumeBgm","pauseBgm","console","log","setSoundState","Facade","sendNotification","TagConst","TAG_SETTING_OPEN_SFX","TAG_SETTING_CLOSE_SFX","isBgmOpen","listener","event","EventListener","TOUCH_ONE_BY_ONE","swallowTouches","onTouchBegan","touches","onTouchMoved","onTouchEnded","eventManager","addListener","onDestroy","removeListener"],"mappings":";;;;;;AAAAA,GAAGC,KAAH,CAAS;AACLC,aAASF,GAAGG,SADP;;AAGLC,gBAAY;AACRC,mBAAYL,GAAGM,SADP;AAERC,qBAAc,CAAC,CAFP;AAGRC,gCAAyB,CAHjB;AAIRC,kCAA2B,CAJnB;;AAMRC,sBAAeV,GAAGW,CAAH,CAAK,CAAL,EAAO,CAAP,CANP;AAORC,uBAAgBZ,GAAGW,CAAH,CAAK,CAAL,EAAO,CAAP,CAPR;AAQRE,sBAAeb,GAAGW,CAAH,CAAK,CAAL,EAAO,CAAP,CARP;AASRG,uBAAgBd,GAAGW,CAAH,CAAK,CAAL,EAAO,CAAP;AATR,KAHP;;AAeLI,YAAQ,kBAAY;AAAA;;AAChB,aAAKC,mBAAL;AACA,aAAKC,gBAAL;;AAEA,YAAIC,WAAWlB,GAAGmB,IAAH,CAAQ,iBAAR,EAA2B,KAAKC,IAAhC,CAAf;AACA,YAAIC,SAASrB,GAAGmB,IAAH,CAAQ,eAAR,EAAyB,KAAKC,IAA9B,CAAb;AACA,YAAIE,WAAYtB,GAAGmB,IAAH,CAAQ,iBAAR,EAA2B,KAAKC,IAAhC,CAAhB;;AAEAF,iBAASK,EAAT,CAAY,OAAZ,EAAqB,UAACC,EAAD,EAAQ;AACzB,gBAAIC,cAAczB,GAAG0B,EAAH,CAAMC,YAAN,CAAmBF,WAAnB,CAA+BzB,GAAG0B,EAAH,CAAME,aAAN,CAAoBC,MAAnD,CAAlB;AACA,gBAAIJ,WAAJ,EAAiBzB,GAAG0B,EAAH,CAAMI,SAAN,CAAgBC,OAAhB,CAAwB,MAAK1B,SAA7B;;AAEjB,gBAAI2B,aAAahC,GAAGmB,IAAH,CAAQ,QAAR,EAAkB,MAAKC,IAAvB,CAAjB;AACAY,uBAAWC,SAAX,CAAqBjC,GAAGkC,QAAH,CAAYlC,GAAGmC,OAAH,CAAW,GAAX,EAAgB,GAAhB,EAAqB,GAArB,CAAZ,EAAuCnC,GAAGoC,QAAH,CAAY,YAAM;AAAE,sBAAKhB,IAAL,CAAUiB,OAAV;AAAsB,aAA1C,CAAvC,CAArB;AAEH,SAPD;;AAUAhB,eAAOE,EAAP,CAAU,OAAV,EAAmB,UAACC,EAAD,EAAQ;AACvB,gBAAIc,YAAYtC,GAAGW,CAAH,CAAK,CAAL,EAAQ,CAAR,CAAhB;;AAEA,gBAAI,MAAKH,sBAAL,KAAgC,CAApC,EAAuC;AAAE;AACrC,sBAAKA,sBAAL,GAA8B,CAA9B;AACA,sBAAK+B,QAAL;;AAEAD,0BAAUE,CAAV,GAAc,MAAK9B,YAAL,CAAkB8B,CAAhC;AACAF,0BAAUG,CAAV,GAAc,MAAK/B,YAAL,CAAkB+B,CAAhC;AACH,aAND,MAMM;AAAE;AACJ,sBAAKjC,sBAAL,GAA8B,CAA9B;AACA,sBAAKkC,SAAL;;AAEAJ,0BAAUE,CAAV,GAAc,MAAK5B,aAAL,CAAmB4B,CAAjC;AACAF,0BAAUG,CAAV,GAAc,MAAK7B,aAAL,CAAmB6B,CAAjC;AACH;;AAEDpB,mBAAOY,SAAP,CAAiBjC,GAAG2C,MAAH,CAAU,IAAV,EAAgBL,SAAhB,CAAjB;AAEH,SAnBD;;AAqBAhB,iBAASC,EAAT,CAAY,OAAZ,EAAqB,UAACC,EAAD,EAAQ;AACzB,gBAAIc,YAAYtC,GAAGW,CAAH,CAAK,CAAL,EAAQ,CAAR,CAAhB;;AAEA,gBAAI,MAAKF,wBAAL,KAAkC,CAAtC,EAAyC;AAAC;AACtC,sBAAKA,wBAAL,GAAgC,CAAhC;AACA,sBAAKmC,UAAL;;AAEAN,0BAAUE,CAAV,GAAc,MAAK3B,YAAL,CAAkB2B,CAAhC;AACAF,0BAAUG,CAAV,GAAc,MAAK5B,YAAL,CAAkB4B,CAAhC;AAEH,aAPD,MAOM;AAAC;AACH,sBAAKhC,wBAAL,GAAgC,CAAhC;AACA,sBAAKoC,WAAL;;AAEAP,0BAAUE,CAAV,GAAc,MAAK1B,aAAL,CAAmB0B,CAAjC;AACAF,0BAAUG,CAAV,GAAc,MAAK3B,aAAL,CAAmB2B,CAAjC;AACH;;AAEDnB,qBAASW,SAAT,CAAmBjC,GAAG2C,MAAH,CAAU,IAAV,EAAgBL,SAAhB,CAAnB;AACH,SAnBD;;AAqBA,YAAIN,aAAahC,GAAGmB,IAAH,CAAQ,QAAR,EAAkB,KAAKC,IAAvB,CAAjB;AACAY,mBAAWc,QAAX,CAAoB,GAApB;AACAd,mBAAWC,SAAX,CAAqBjC,GAAG+C,aAAH,CAAiBC,MAAjB,CAAwBhD,GAAGmC,OAAH,CAAW,GAAX,EAAgB,GAAhB,EAAqB,GAArB,CAAxB,CAArB;AACH,KA9EI;;AAgFLI,cAAW,oBAAY;AACnB,YAAIV,SAAS7B,GAAG0B,EAAH,CAAME,aAAN,CAAoBC,MAAjC;AACA7B,WAAG0B,EAAH,CAAMC,YAAN,CAAmBsB,WAAnB,CAA+BpB,MAA/B,EAAuC,IAAvC;;AAEA7B,WAAG0B,EAAH,CAAMI,SAAN,CAAgBoB,SAAhB;AACH,KArFI;;AAuFLR,eAAY,qBAAY;AACpB,YAAIb,SAAS7B,GAAG0B,EAAH,CAAME,aAAN,CAAoBC,MAAjC;AACA7B,WAAG0B,EAAH,CAAMC,YAAN,CAAmBsB,WAAnB,CAA+BpB,MAA/B,EAAuC,KAAvC;;AAEA7B,WAAG0B,EAAH,CAAMI,SAAN,CAAgBqB,QAAhB;AACH,KA5FI;;AA8FLP,gBAAa,sBAAY;AACrBQ,gBAAQC,GAAR,CAAY,kBAAZ;AACA,YAAIxB,SAAS7B,GAAG0B,EAAH,CAAME,aAAN,CAAoBC,MAAjC;AACA7B,WAAG0B,EAAH,CAAMC,YAAN,CAAmB2B,aAAnB,CAAiCzB,MAAjC,EAAyC,IAAzC;;AAEA7B,WAAG0B,EAAH,CAAMI,SAAN,CAAgBC,OAAhB,CAAwB,KAAK1B,SAA7B;AACAL,WAAG0B,EAAH,CAAM6B,MAAN,CAAaC,gBAAb,CAA8BxD,GAAG0B,EAAH,CAAM+B,QAAN,CAAeC,oBAA7C,EANqB,CAM8C;AACtE,KArGI;;AAuGLb,iBAAc,uBAAY;AACtBO,gBAAQC,GAAR,CAAY,kBAAZ;AACA,YAAIxB,SAAS7B,GAAG0B,EAAH,CAAME,aAAN,CAAoBC,MAAjC;AACA7B,WAAG0B,EAAH,CAAMC,YAAN,CAAmB2B,aAAnB,CAAiCzB,MAAjC,EAAyC,KAAzC;AACA7B,WAAG0B,EAAH,CAAM6B,MAAN,CAAaC,gBAAb,CAA8BxD,GAAG0B,EAAH,CAAM+B,QAAN,CAAeE,qBAA7C,EAJsB,CAI8C;AACvE,KA5GI;;AA+GL1C,oBA/GK,8BAgHL;AACI,YAAII,SAASrB,GAAGmB,IAAH,CAAQ,eAAR,EAAyB,KAAKC,IAA9B,CAAb;AACA,YAAIE,WAAYtB,GAAGmB,IAAH,CAAQ,iBAAR,EAA2B,KAAKC,IAAhC,CAAhB;;AAEA,YAAIS,SAAS7B,GAAG0B,EAAH,CAAME,aAAN,CAAoBC,MAAjC;AACA,YAAI+B,YAAY5D,GAAG0B,EAAH,CAAMC,YAAN,CAAmBiC,SAAnB,CAA6B/B,MAA7B,CAAhB;AACA,YAAIJ,cAAczB,GAAG0B,EAAH,CAAMC,YAAN,CAAmBF,WAAnB,CAA+BI,MAA/B,CAAlB;;AAEA,YAAI+B,SAAJ,EAAe;AACX,iBAAKpD,sBAAL,GAA8B,CAA9B;AACAa,mBAAOmB,CAAP,GAAW,KAAK9B,YAAL,CAAkB8B,CAA7B;AACAnB,mBAAOoB,CAAP,GAAW,KAAK/B,YAAL,CAAkB+B,CAA7B;AACH,SAJD,MAIM;AACF,iBAAKjC,sBAAL,GAA8B,CAA9B;AACAa,mBAAOmB,CAAP,GAAW,KAAK5B,aAAL,CAAmB4B,CAA9B;AACAnB,mBAAOoB,CAAP,GAAW,KAAK7B,aAAL,CAAmB6B,CAA9B;AACH;AACD,YAAIhB,WAAJ,EACA;AACIH,qBAASkB,CAAT,GAAa,KAAK3B,YAAL,CAAkB2B,CAA/B;AACAlB,qBAASmB,CAAT,GAAa,KAAK5B,YAAL,CAAkB4B,CAA/B;;AAEA,iBAAKhC,wBAAL,GAAgC,CAAhC;AAEH,SAPD,MAOM;AACF,iBAAKA,wBAAL,GAAgC,CAAhC;AACAa,qBAASkB,CAAT,GAAa,KAAK1B,aAAL,CAAmB0B,CAAhC;AACAlB,qBAASmB,CAAT,GAAa,KAAK3B,aAAL,CAAmB2B,CAAhC;AACH;AACJ,KA7II;;;AAiJLzB,yBAAsB,+BAAW;AAC7B,YAAI6C,WAAW;AACXC,mBAAQ9D,GAAG+D,aAAH,CAAiBC,gBADd;AAEXC,4BAAiB,IAFN;AAGXC,0BAAe,sBAASC,OAAT,EAAkBL,KAAlB,EAAyB;AACpC,uBAAO,IAAP;AACH,aALU;AAMXM,0BAAe,sBAASN,KAAT,EAAgB,CAE9B,CARU;AASXO,0BAAe,sBAASP,KAAT,EAAgB,CAE9B;AAXU,SAAf;AAaA,aAAKvD,WAAL,GAAmBP,GAAGsE,YAAH,CAAgBC,WAAhB,CAA4BV,QAA5B,EAAsC,KAAKzC,IAA3C,CAAnB;AACH,KAhKI;;AAkKLoD,aAlKK,uBAkKM;AACPxE,WAAGsE,YAAH,CAAgBG,cAAhB,CAA+B,KAAKlE,WAApC;AACJ;AApKK,CAAT","file":"Setting.js","sourceRoot":"../../../../../../../../assets/scripts/GameModule/Base/Module/View","sourcesContent":["cc.Class({\n    extends: cc.Component,\n\n    properties: {\n        buttonSfx : cc.AudioClip,\n        _listenerId : -1,\n        _currentBgmCircleState : 0,\n        _currentSoundCircleState : 0,\n\n        bgmOpenPoint : cc.p(0,0),\n        bgmClosePoint : cc.p(0,0),\n        sfxOpenPoint : cc.p(0,0),\n        sfxClosePoint : cc.p(0,0),\n    },\n\n    onLoad: function () {\n        this._registerTouchEvent();\n        this._initBtnPosition();\n\n        let closeBtn = cc.find('layout/closeBtn', this.node);\n        let bgmBtn = cc.find('layout/bgmBtn', this.node);\n        let soundBtn =  cc.find('layout/soundBtn', this.node);\n\n        closeBtn.on('click', (ev) => {\n            let isSoundOpen = cc.ss.localStorage.isSoundOpen(cc.ss.userInfoCache.userId);\n            if (isSoundOpen) cc.ss.audioUtil.playSfx(this.buttonSfx);\n\n            let layoutNode = cc.find('layout', this.node);\n            layoutNode.runAction(cc.sequence(cc.scaleTo(0.2, 0.1, 0.1), cc.callFunc(() => { this.node.destroy(); })));\n\n        });\n\n\n        bgmBtn.on('click', (ev) => {\n            let targetPos = cc.p(0, 0);\n\n            if (this._currentBgmCircleState === 0) { // 关闭 --> 开启\n                this._currentBgmCircleState = 1;\n                this._openBgm();\n\n                targetPos.x = this.bgmOpenPoint.x;\n                targetPos.y = this.bgmOpenPoint.y;\n            }else { //开启 --> 关闭\n                this._currentBgmCircleState = 0;\n                this._closeBgm();\n\n                targetPos.x = this.bgmClosePoint.x;\n                targetPos.y = this.bgmClosePoint.y;\n            }\n\n            bgmBtn.runAction(cc.moveTo(0.09, targetPos));\n\n        });\n\n        soundBtn.on('click', (ev) => {\n            let targetPos = cc.p(0, 0);\n\n            if (this._currentSoundCircleState === 0) {// 关闭 --> 开启\n                this._currentSoundCircleState = 1;\n                this._openSound();\n\n                targetPos.x = this.sfxOpenPoint.x;\n                targetPos.y = this.sfxOpenPoint.y;\n\n            }else {//开启 --> 关闭\n                this._currentSoundCircleState = 0;\n                this._closeSound();\n\n                targetPos.x = this.sfxClosePoint.x;\n                targetPos.y = this.sfxClosePoint.y;\n            }\n\n            soundBtn.runAction(cc.moveTo(0.09, targetPos));\n        });\n\n        let layoutNode = cc.find('layout', this.node);\n        layoutNode.setScale(0.1);\n        layoutNode.runAction(cc.EaseBounceOut.create(cc.scaleTo(0.5, 1.0, 1.0)));\n    },\n\n    _openBgm : function () {\n        let userId = cc.ss.userInfoCache.userId;\n        cc.ss.localStorage.setBgmState(userId, true);\n\n        cc.ss.audioUtil.resumeBgm();\n    },\n\n    _closeBgm : function () {\n        let userId = cc.ss.userInfoCache.userId;\n        cc.ss.localStorage.setBgmState(userId, false);\n\n        cc.ss.audioUtil.pauseBgm();\n    },\n\n    _openSound : function () {\n        console.log(\"[Setting]开启sound\");\n        let userId = cc.ss.userInfoCache.userId;\n        cc.ss.localStorage.setSoundState(userId, true);\n\n        cc.ss.audioUtil.playSfx(this.buttonSfx);\n        cc.ss.Facade.sendNotification(cc.ss.TagConst.TAG_SETTING_OPEN_SFX);//发送开启音效的通知\n    },\n\n    _closeSound : function () {\n        console.log(\"[Setting]关闭sound\");\n        let userId = cc.ss.userInfoCache.userId;\n        cc.ss.localStorage.setSoundState(userId, false);\n        cc.ss.Facade.sendNotification(cc.ss.TagConst.TAG_SETTING_CLOSE_SFX);//发送关闭音效的通知\n    },\n\n\n    _initBtnPosition()\n    {\n        let bgmBtn = cc.find('layout/bgmBtn', this.node);\n        let soundBtn =  cc.find('layout/soundBtn', this.node);\n\n        let userId = cc.ss.userInfoCache.userId;\n        let isBgmOpen = cc.ss.localStorage.isBgmOpen(userId);\n        let isSoundOpen = cc.ss.localStorage.isSoundOpen(userId);\n\n        if (isBgmOpen) {\n            this._currentBgmCircleState = 1;\n            bgmBtn.x = this.bgmOpenPoint.x;\n            bgmBtn.y = this.bgmOpenPoint.y;\n        }else {\n            this._currentBgmCircleState = 0;\n            bgmBtn.x = this.bgmClosePoint.x;\n            bgmBtn.y = this.bgmClosePoint.y;\n        }\n        if (isSoundOpen)\n        {\n            soundBtn.x = this.sfxOpenPoint.x;\n            soundBtn.y = this.sfxOpenPoint.y;\n\n            this._currentSoundCircleState = 1;\n\n        }else {\n            this._currentSoundCircleState = 0;\n            soundBtn.x = this.sfxClosePoint.x;\n            soundBtn.y = this.sfxClosePoint.y;\n        }\n    },\n\n\n\n    _registerTouchEvent : function() {\n        let listener = {\n            event : cc.EventListener.TOUCH_ONE_BY_ONE,\n            swallowTouches : true,\n            onTouchBegan : function(touches, event) {\n                return true;\n            },\n            onTouchMoved : function(event) {\n\n            },\n            onTouchEnded : function(event) {\n\n            }\n        };\n        this._listenerId = cc.eventManager.addListener(listener, this.node);\n    },\n\n    onDestroy(){\n        cc.eventManager.removeListener(this._listenerId);\n   }\n\n});\n"]}