{"version":3,"sources":["LauncherProxy.js"],"names":["Proxy","require","RequestTaskFactory","Task_Type","LauncherProxy","_cacheRecoverLifeSeconds","_cacheHpNum","cc","ss","NameConst","NAME_PROXY_LAUNCHER","userId","_requestUserInfo","task","createTask","Api_Forum","URLConst","getUserInfoURL","_onResponseUserInfo","bind","doGet","data","infoCode","obj","JSON","parse","errcode","userInfo","result","user","console","log","stringify","userInfoCache","userLevel","level","userStarNum","starCount","recoverHpSecond","_sendLoadingProgressNotification","_requestUserLife","_sendShowErrorDialogNotification","getLifeURL","_onResponseUserLifeInfo","hp","rlt","recoverLifeSeconds","Facade","sendNotification","TagConst","TAG_LAUNCHER_GAME_INITIALIZE_INFO_COMPLETE","getProductRecommendURL","_onResponseProductRecommendList","errRlt","proxyType","GlobalConst","PROXY_LAUNCHER_CONTROLLER","errorType","ErrorConst","NET_ERROR_LAUNCHER_LOGIN","TAG_SHOW_NET_ERROR_DIALOG","value","TAG_LAUNCHER_LOADING_PROGRESS","module","exports"],"mappings":"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","file":"LauncherProxy.js","sourceRoot":"../../../../../../../../assets/scripts/GameModule/Launcher/Module/Model","sourcesContent":["const Proxy = require('Proxy');\nconst {RequestTaskFactory, Task_Type} = require('RequestTaskFactory');\n\nclass LauncherProxy extends Proxy\n{\n    constructor()\n    {\n        super();\n        this._cacheRecoverLifeSeconds = 0;\n        this._cacheHpNum = 0;\n    }\n    getProxyName() { return cc.ss.NameConst.NAME_PROXY_LAUNCHER; }\n\n    /**\n     * 请求初始化信息\n     * @param userId\n     */\n    requestGameInitializeInfo(userId) { this._requestUserInfo(userId); }\n\n\n    /**\n     * 请求用户信息\n     * @param userId 用户id\n     */\n    _requestUserInfo(userId)\n    {\n        let task = RequestTaskFactory.createTask(Task_Type.Api_Forum, cc.ss.URLConst.getUserInfoURL(), {}, this._onResponseUserInfo.bind(this));\n        task.doGet();\n    }\n\n\n    /**\n     * 用户信息Response\n     * @param data\n     * @private\n     */\n    _onResponseUserInfo(data) {\n        let infoCode = data.infoCode;\n        if (infoCode === 0) {\n            let obj = JSON.parse(data.data);\n            if (obj.errcode === 0) {\n\n                let userInfo = obj.result.user;\n                console.log(`${JSON.stringify(userInfo)}`);\n                cc.ss.userInfoCache.userLevel = userInfo.level;\n                cc.ss.userInfoCache.userStarNum = userInfo.starCount;\n\n                this._cacheRecoverLifeSeconds = obj.result.recoverHpSecond;\n\n                this._sendLoadingProgressNotification(0.1);\n\n                this._requestUserLife();//请求用户体力值\n\n            } else {\n                this._sendShowErrorDialogNotification();\n            }\n\n        } else {\n            this._sendShowErrorDialogNotification();\n        }\n    }\n\n\n    _requestUserLife()\n    {\n        let task = RequestTaskFactory.createTask(Task_Type.Api_Forum, cc.ss.URLConst.getLifeURL(), {}, this._onResponseUserLifeInfo.bind(this));\n        task.doGet();\n    }\n\n    _onResponseUserLifeInfo(data)\n    {\n        let infoCode = data.infoCode;\n        if (infoCode === 0) {\n            let obj = JSON.parse(data.data);\n            if (obj.errcode === 0) {\n\n                this._cacheHpNum = obj.result.hp;\n                let rlt = {};\n                rlt.recoverLifeSeconds = this._cacheRecoverLifeSeconds;\n                rlt.hp = this._cacheHpNum;\n                this._sendLoadingProgressNotification(0.1);\n                cc.ss.Facade.sendNotification(cc.ss.TagConst.TAG_LAUNCHER_GAME_INITIALIZE_INFO_COMPLETE, rlt);\n\n            }else {\n                this._sendShowErrorDialogNotification();\n            }\n\n        }else {\n            this._sendShowErrorDialogNotification();\n        }\n\n    }\n\n    /**\n     * 请求商品推荐列表\n     * @private\n     */\n    _requestProductRecommendList(){\n\n        let task = RequestTaskFactory.createTask(Task_Type.Api_Forum, cc.ss.URLConst.getProductRecommendURL(), {}, this._onResponseProductRecommendList.bind(this));\n        task.doGet();\n\n    }\n\n    _onResponseProductRecommendList (data){\n\n        let infoCode = data.infoCode;\n        if (infoCode === 0) {\n            let obj = JSON.parse(data.data);\n            if (obj.errcode === 0) {\n\n\n            }else {\n                this._sendShowErrorDialogNotification();\n            }\n\n        }else {\n            this._sendShowErrorDialogNotification();\n        }\n\n    }\n\n    /**\n     * 发送显示网络对话框\n     * @private\n     */\n    _sendShowErrorDialogNotification()\n    {\n        let errRlt = {\n            proxyType : cc.ss.GlobalConst.PROXY_LAUNCHER_CONTROLLER,\n            errorType : cc.ss.ErrorConst.NET_ERROR_LAUNCHER_LOGIN,\n        };\n        cc.ss.Facade.sendNotification(cc.ss.TagConst.TAG_SHOW_NET_ERROR_DIALOG, errRlt);\n    }\n\n    _sendLoadingProgressNotification(value)\n    {\n        cc.ss.Facade.sendNotification(cc.ss.TagConst.TAG_LAUNCHER_LOADING_PROGRESS, value);\n    }\n\n\n}//end class\n\nmodule.exports = LauncherProxy;\n"]}