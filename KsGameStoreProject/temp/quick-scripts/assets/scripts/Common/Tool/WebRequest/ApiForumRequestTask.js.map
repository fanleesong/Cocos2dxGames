{"version":3,"sources":["ApiForumRequestTask.js"],"names":["BaseWebRequestTask","require","ApiForumRequestTask","url","params","callback","xhr","getXMLHttpRequest","str","k","encodeURI","console","log","onreadystatechange","_onReadyStateChange","ontimeout","e","_onTimeOut","onerror","_onError","open","send","dataStr","readyState","status","responseText","respInfo","getRepsonseBody","error","JSON","stringify","module","exports"],"mappings":"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","file":"ApiForumRequestTask.js","sourceRoot":"../../../../../../../assets/scripts/Common/Tool/WebRequest","sourcesContent":["const BaseWebRequestTask = require('BaseWebRequestTask');\n\nclass ApiForumRequestTask extends BaseWebRequestTask{\n    constructor(url, params = null, callback)\n    {\n        super(url, params, callback);\n    }\n\n\n    doGet() {\n        let xhr = this.getXMLHttpRequest();\n\n        let str = \"?\";\n        for (let k in this.params)\n        {\n            if(str !== \"?\") str += \"&\";\n            str +=`${k}=${this.params[k]}`;\n        }\n\n        if (str !== \"?\") this.url += encodeURI(str);\n        console.log(`[ApiForumRequestTask]Get封装后请求地址:${this.url}`);\n\n        xhr.onreadystatechange = () => { this._onReadyStateChange(xhr); };\n        xhr.ontimeout = (e) => { this._onTimeOut(e); };\n        xhr.onerror = (e) => { this._onError(e); };\n\n        xhr.open(\"GET\", this.url, true);\n        xhr.send();\n    }\n\n    doPost() {\n        let xhr = this.getXMLHttpRequest();\n\n        xhr.onreadystatechange = () => { this._onReadyStateChange(xhr); };\n        xhr.ontimeout = (e) => { this._onTimeOut(e); };\n        xhr.onerror = (e) => { this._onError(e); };\n\n        let dataStr = \"\";\n        for(let k in this.params){\n            if (dataStr !== \"\") dataStr += \"&\";\n            dataStr += `${k}=${this.params[k]}`;\n        }\n        xhr.open(\"POST\",this.url);\n        xhr.send(dataStr);\n    }\n\n\n\n    _onReadyStateChange(xhr){\n        if (xhr.readyState === 4 && (xhr.status >= 200 && xhr.status < 400)) {\n            let responseText = xhr.responseText;\n            console.log(`[[ApiForumRequestTask]请求响应Response:${responseText}]`);\n\n            if (this.callback !== null) {\n                let respInfo = this.getRepsonseBody(0, responseText);\n                this.callback(respInfo);\n            }\n\n        }\n    }\n\n    /**\n     * 请求超时回调\n     * @param error\n     * @private\n     */\n    _onTimeOut(error){\n        console.log(`[[ApiForumRequestTask]请求发生超时:${error}]`);\n        if (this.callback !== null)\n        {\n            let respInfo = this.getRepsonseBody(1, \"超时\");\n            this.callback(respInfo);\n        }\n    }\n\n    /**\n     * 网络错误回调\n     * @param error\n     * @private\n     */\n    _onError(error)\n    {\n        console.log(`[[ApiForumRequestTask]请求发生错误:${JSON.stringify(error)}]`);\n        if (this.callback)\n        {\n            let respInfo = this.getRepsonseBody(2, \"网络错误\");\n            this.callback(respInfo);\n        }\n    }\n\n\n}//end class\n\nmodule.exports = ApiForumRequestTask;\n"]}