{"version":3,"sources":["HotUpdate.js"],"names":["UpdatePanel","require","customManifestStr","JSON","stringify","cc","Class","extends","Component","properties","panel","manifestUrl","default","url","RawAsset","updateUI","Node","_updating","_canRetry","_storagePath","checkCb","event","log","getEventCode","jsb","EventAssetsManager","ERROR_NO_LOCAL_MANIFEST","info","string","ERROR_DOWNLOAD_MANIFEST","ERROR_PARSE_MANIFEST","ALREADY_UP_TO_DATE","NEW_VERSION_FOUND","checkBtn","active","fileProgress","progress","byteProgress","_checkListener","updateCb","needRestart","failed","UPDATE_PROGRESSION","getPercent","getPercentByFile","fileLabel","getDownloadedFiles","getTotalFiles","byteLabel","getDownloadedBytes","getTotalBytes","msg","getMessage","UPDATE_FINISHED","UPDATE_FAILED","retryBtn","ERROR_UPDATING","getAssetId","ERROR_DECOMPRESS","_updateListener","searchPaths","fileUtils","getSearchPaths","newPaths","_am","getLocalManifest","console","Array","prototype","unshift","apply","sys","localStorage","setItem","setSearchPaths","audioEngine","stopAll","game","restart","loadCustomManifest","getState","AssetsManager","State","UNINITED","manifest","Manifest","loadLocalManifest","retry","downloadFailedAssets","checkUpdate","loader","md5Pipe","transformURL","isLoaded","EventListenerAssetsManager","bind","eventManager","addListener","hotUpdate","_failCount","update","updateBtn","show","onLoad","isNative","getWritablePath","versionCompareHandle","versionA","versionB","vA","split","vB","i","length","a","parseInt","b","setVerifyCallback","path","asset","compressed","expectedMD5","md5","relativePath","size","os","OS_ANDROID","setMaxConcurrentTask","onDestroy","removeListener"],"mappings":"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","file":"HotUpdate.js","sourceRoot":"../../../../../assets/scripts/module","sourcesContent":["var UpdatePanel = require('../UI/UpdatePanel');\n\n// Custom manifest removed the following assets:\n// 1. res/raw-assets/2a/2a40e5e7-4c4a-4350-9e5d-76757755cdd2.png\n// 2. res/raw-assets/2d/2d86a854-63c4-4b90-8b88-a4328b8526c2.png\n// So when custom manifest used, you should be able to find them in downloaded remote assets\nvar customManifestStr = JSON.stringify({\n    \"packageUrl\": \"http://127.0.0.1/hotUpdate/remote-assets/\",\n    \"remoteManifestUrl\": \"http://127.0.0.1/hotUpdate/remote-assets/project.manifest\",\n    \"remoteVersionUrl\": \"http://127.0.0.1/hotUpdate/remote-assets/version.manifest\",\n    \"version\": \"1.10\",\n    \"assets\": {\n        \"src/cocos2d-jsb.js\": {\n            \"size\": 3341465,\n            \"md5\": \"fafdde66bd0a81d1e096799fb8b7af95\"\n        },\n        \"src/project.dev.js\": {\n            \"size\": 97814,\n            \"md5\": \"ed7f5acd411a09d4d298db800b873b00\"\n        },\n        \"src/settings.js\": {\n            \"size\": 3849,\n            \"md5\": \"deb03998a4cfb8f8b468fba8575cb1c9\"\n        },\n        \"res/import/03/0379fb962.json\": {\n            \"size\": 1107,\n            \"md5\": \"d102d0f14ed6b6cb42cc28d88b3b9069\"\n        },\n        \"res/import/0c/0cd5de143.json\": {\n            \"size\": 80883,\n            \"md5\": \"f06347880038a1381043ed505d6f8a9a\"\n        },\n        \"res/import/0d/0d756af45.json\": {\n            \"size\": 10137,\n            \"md5\": \"02dc8b795e79b9fd62e00d4a2c70c8c1\"\n        },\n        \"res/import/0d/0dc6a4e59.json\": {\n            \"size\": 14970,\n            \"md5\": \"a500f696892df6869341dff5f31b1a33\"\n        },\n        \"res/import/41/4128b78b-00ae-4d8a-ae35-4e5ca5c5cde9.json\": {\n            \"size\": 76,\n            \"md5\": \"3f79d93ce8d42b186ecd43d868c8d023\"\n        },\n        \"res/import/49/49539cb0-3893-459a-b310-7cc1b7f6d335.json\": {\n            \"size\": 72,\n            \"md5\": \"8a36388cda7c3773b5bf7a53d8824535\"\n        },\n        \"res/import/9e/9e2ae507-fae5-4511-940b-f2e46f81b790.json\": {\n            \"size\": 74,\n            \"md5\": \"98f6b1d93a4ee3a1f2074be9ce00fbb2\"\n        },\n        \"res/raw-assets/0e/0ed8cf6e-8c04-4569-8d17-626a26e1099f.png\": {\n            \"size\": 4665,\n            \"md5\": \"9e8bf9af30ac7a9ea9d3b72f37a193e1\"\n        },\n        \"res/raw-assets/13/137d1ca6-e90c-440b-9fa2-4b9ffff569f7.png\": {\n            \"size\": 1627,\n            \"md5\": \"75060291e24294abd6a52553fa22317e\"\n        },\n        \"res/raw-assets/15/15d5f3f0-f965-4c00-945b-d2c8faee78b6.png\": {\n            \"size\": 3840,\n            \"md5\": \"cb525edab8063a845e6bd1e9d29b8cde\"\n        },\n        \"res/raw-assets/19/19509bb1-dc08-4cbf-ab8f-2460e207265c.png\": {\n            \"size\": 9638,\n            \"md5\": \"6e159c9cc1b971d3921bc8908071a70b\"\n        },\n        \"res/raw-assets/26/26e9a867-3d2f-4981-8a33-82d440de7aff.png\": {\n            \"size\": 6417,\n            \"md5\": \"5c139729708dd26bd461bcd3e8201823\"\n        },\n        \"res/raw-assets/2d/2ddfe005-2129-41d8-aeec-2b1f51f02962.png\": {\n            \"size\": 2290,\n            \"md5\": \"874dccfd88108a9f0188bda59c5df183\"\n        },\n        \"res/raw-assets/34/3459ab36-782c-4c4e-8aef-7280aff8b272.png\": {\n            \"size\": 18969,\n            \"md5\": \"3a810a636f3779b357e854155eafa4b6\"\n        },\n        \"res/raw-assets/36/36b6ea73-ff48-430e-a0c7-0e5e8defe341.png\": {\n            \"size\": 2711,\n            \"md5\": \"e64625aeb59a1de225e718a7126634ad\"\n        },\n        \"res/raw-assets/39/394bac82-54fb-472f-a27f-b5107821bfb8.png\": {\n            \"size\": 1641,\n            \"md5\": \"049d2201d7d99fc6dbdb017d8d8bd9b8\"\n        },\n        \"res/raw-assets/3c/3cedb8b4-8532-4037-a00e-b8d3e0013158.png\": {\n            \"size\": 94313,\n            \"md5\": \"a2e763866c1bdd6b189be69f3d37eedd\"\n        },\n        \"res/raw-assets/41/4128b78b-00ae-4d8a-ae35-4e5ca5c5cde9.manifest\": {\n            \"size\": 6358,\n            \"md5\": \"c1d18879851e567545ea04bf135a325f\"\n        },\n        \"res/raw-assets/49/49539cb0-3893-459a-b310-7cc1b7f6d335.mp3\": {\n            \"size\": 971644,\n            \"md5\": \"f45ec6666f06b729d8c0461bc89d4b94\"\n        },\n        \"res/raw-assets/4e/4e06c7f1-72ac-4e4e-90de-683e16905156.png\": {\n            \"size\": 2406,\n            \"md5\": \"5f0c28e0eed7ec0cb75e45f5937dd7c6\"\n        },\n        \"res/raw-assets/50/50da5486-dfa1-46d2-9d4f-686eb5527c1a.png\": {\n            \"size\": 6911,\n            \"md5\": \"51cf32529c923146f06019a58398c98d\"\n        },\n        \"res/raw-assets/52/5245e25c-010c-45fb-84a3-f3bce95793e7.png\": {\n            \"size\": 3963,\n            \"md5\": \"0f050ba45e09986b3d785b7b23ffcc1e\"\n        },\n        \"res/raw-assets/6d/6de06a23-d0de-4766-a9e1-a0314136d62e.png\": {\n            \"size\": 10878,\n            \"md5\": \"9f89eec7a1b0f615a3c1bab0857aefff\"\n        },\n        \"res/raw-assets/70/700faa17-11a6-46cd-aeb5-d6900bc264f8.png\": {\n            \"size\": 3765,\n            \"md5\": \"878e89a0a3e02b13beee9f3274f2ca39\"\n        },\n        \"res/raw-assets/71/71561142-4c83-4933-afca-cb7a17f67053.png\": {\n            \"size\": 1050,\n            \"md5\": \"c06a93f5f1a8a1c6edc4fd8b52e96cbf\"\n        },\n        \"res/raw-assets/80/8071df9d-029b-40e8-98f3-8eab08dbf6ca.png\": {\n            \"size\": 25205,\n            \"md5\": \"f688777a92fba11bfe85c3061a4476e5\"\n        },\n        \"res/raw-assets/82/82fe58d4-ae13-4806-9a41-2e73902ea811.png\": {\n            \"size\": 24298,\n            \"md5\": \"b807df8ffcb540f3dd20db75ac95b73b\"\n        },\n        \"res/raw-assets/83/83cc2086-d713-47a0-8d86-a8d6068b6258.png\": {\n            \"size\": 3782,\n            \"md5\": \"9827ce705349caa604e1aba1d53b0fd9\"\n        },\n        \"res/raw-assets/96/96e3e293-4e36-426d-a0a6-eb8d025c0d5b.png\": {\n            \"size\": 15379,\n            \"md5\": \"d6ce47aed38348a1ea0f003fa0063079\"\n        },\n        \"res/raw-assets/97/97a6316c-7fcb-4ffe-9045-35625bc6abf6.png\": {\n            \"size\": 2187,\n            \"md5\": \"f3f41b4c0783a751e561f1b84d91a70b\"\n        },\n        \"res/raw-assets/97/97bb9c9c-5568-4419-af04-4ed5a2969a02.png\": {\n            \"size\": 10370,\n            \"md5\": \"48ab94f1c34b0e9a047297cab1aeabc4\"\n        },\n        \"res/raw-assets/99/99170b0b-d210-46f1-b213-7d9e3f23098a.png\": {\n            \"size\": 1177,\n            \"md5\": \"d1118d133683bb4227d5e60c79c846b7\"\n        },\n        \"res/raw-assets/99/99acc716-33df-4c4c-879d-cc3407f0cd8c.png\": {\n            \"size\": 9754,\n            \"md5\": \"23e7221934021f3fbe6c6a52b023ded8\"\n        },\n        \"res/raw-assets/9e/9e2ae507-fae5-4511-940b-f2e46f81b790.mp3\": {\n            \"size\": 3179,\n            \"md5\": \"90d17b1a25200c90e292d9a3748c9fec\"\n        },\n        \"res/raw-assets/ac/ac11439d-3758-49f5-8728-81ed22c1ed96.png\": {\n            \"size\": 11935,\n            \"md5\": \"c20ae4a74c42b2aed28bb8c9247eb5d5\"\n        },\n        \"res/raw-assets/ae/ae4e2188-2b7b-42a9-85e1-8fb987600b04.png\": {\n            \"size\": 634171,\n            \"md5\": \"07b03f7145b75579708ae05ea2a2c029\"\n        },\n        \"res/raw-assets/af/afe329a6-e85e-46a0-98ed-8a34e128907b.png\": {\n            \"size\": 2209,\n            \"md5\": \"30ae2fe844c7c53f1d00291051230607\"\n        },\n        \"res/raw-assets/b2/b2037f34-04ff-4351-b9da-5be4bb557017.png\": {\n            \"size\": 1530,\n            \"md5\": \"bb96dacb8b09e0443d83462cc7b20095\"\n        },\n        \"res/raw-assets/b4/b43ff3c2-02bb-4874-81f7-f2dea6970f18.png\": {\n            \"size\": 1114,\n            \"md5\": \"83fcc9912e01ae5411c357651fb8b1cf\"\n        },\n        \"res/raw-assets/c3/c39ea496-96eb-4dc5-945a-e7c919b77c21.png\": {\n            \"size\": 2548,\n            \"md5\": \"ae7a04af25e238a5478170759b55a7ba\"\n        },\n        \"res/raw-assets/ca/caaaf9ff-5036-4232-a8a7-88b80b2e4c88.png\": {\n            \"size\": 1829,\n            \"md5\": \"94d761c4626df88053787f17fa09914d\"\n        },\n        \"res/raw-assets/ca/cacafa85-d8e9-4716-bcdb-7eba457e409c.png\": {\n            \"size\": 7380,\n            \"md5\": \"e6bb0f4d041257653f07da2dfe1edd09\"\n        },\n        \"res/raw-assets/ce/ce6d2de9-7056-4ba8-a1b1-40b00bb6f469.png\": {\n            \"size\": 10982,\n            \"md5\": \"52aa0df577edafe11de1cfdb44422895\"\n        },\n        \"res/raw-assets/cf/cfef78f1-c8df-49b7-8ed0-4c953ace2621.png\": {\n            \"size\": 1140,\n            \"md5\": \"a4b5953dffeb145b4b70072d91c4052b\"\n        },\n        \"res/raw-assets/d5/d5dfe6a8-eb19-4aae-a74f-83b71eaa57dc.png\": {\n            \"size\": 8755,\n            \"md5\": \"aeb1055ced334ce20fe030579e187494\"\n        },\n        \"res/raw-assets/da/da3e556f-1bce-4c31-87dc-897ea2d788e2.png\": {\n            \"size\": 11636,\n            \"md5\": \"d81124346c110eb1377f7b56346b31e4\"\n        },\n        \"res/raw-assets/e8/e851e89b-faa2-4484-bea6-5c01dd9f06e2.png\": {\n            \"size\": 1082,\n            \"md5\": \"90cf45d059d0408bec327f66eae5764c\"\n        },\n        \"res/raw-assets/ec/ec244ee5-6f1f-4920-9b69-d4df0e78ec2d.png\": {\n            \"size\": 55581,\n            \"md5\": \"68fdff7430b1b02f3a6e76bea92c6372\"\n        },\n        \"res/raw-assets/fc/fccc4d85-6ad4-496d-9b33-ea76e69da132.png\": {\n            \"size\": 82257,\n            \"md5\": \"df4359cdcb956f52f2e5b4ef777bbb7d\"\n        }\n    },\n    \"searchPaths\": []\n});\n\ncc.Class({\n    extends: cc.Component,\n\n    properties: {\n        panel: UpdatePanel,\n        manifestUrl: { default: null, url: cc.RawAsset },\n        updateUI: cc.Node,\n        _updating: false,\n        _canRetry: false,\n        _storagePath: ''\n    },\n\n    checkCb: function (event) {\n        cc.log('Code: ' + event.getEventCode());\n        switch (event.getEventCode())\n        {\n            case jsb.EventAssetsManager.ERROR_NO_LOCAL_MANIFEST:\n                this.panel.info.string = \"热更提示：未发现本地manifest文件！\";//\"No local manifest file found, hot update skipped.\";\n                break;\n            case jsb.EventAssetsManager.ERROR_DOWNLOAD_MANIFEST:\n            case jsb.EventAssetsManager.ERROR_PARSE_MANIFEST:\n                this.panel.info.string = \"热更提示：下载manifest文件失败！\";//\"Fail to download manifest file, hot update skipped.\";\n                break;\n            case jsb.EventAssetsManager.ALREADY_UP_TO_DATE:\n                this.panel.info.string = \"已更新为最新版本！\";//\"Already up to date with the latest remote version.\";\n                break;\n            case jsb.EventAssetsManager.NEW_VERSION_FOUND:\n                this.panel.info.string = \"发现新版本！请尝试更新！\";//'New version found, please try to update.';\n                this.panel.checkBtn.active = false;\n                this.panel.fileProgress.progress = 0;\n                this.panel.byteProgress.progress = 0;\n                break;\n            default:\n                return;\n        }\n        \n        // this._am.setEventCallback(null);\n        this._checkListener = null;\n        this._updating = false;\n    },\n\n    updateCb: function (event) {\n        var needRestart = false;\n        var failed = false;\n        switch (event.getEventCode())\n        {\n            case jsb.EventAssetsManager.ERROR_NO_LOCAL_MANIFEST:\n                this.panel.info.string = \"热更提示：未发现本地manifest文件！\";//'No local manifest file found, hot update skipped.';\n                failed = true;\n                break;\n            case jsb.EventAssetsManager.UPDATE_PROGRESSION:\n                this.panel.byteProgress.progress = event.getPercent();\n                this.panel.fileProgress.progress = event.getPercentByFile();\n\n                this.panel.fileLabel.string = event.getDownloadedFiles() + ' / ' + event.getTotalFiles();\n                this.panel.byteLabel.string = event.getDownloadedBytes() + ' / ' + event.getTotalBytes();\n\n                var msg = event.getMessage();\n                if (msg) {\n                    this.panel.info.string = 'Updated file: ' + msg;\n                    // cc.log(event.getPercent()/100 + '% : ' + msg);\n                }\n                break;\n            case jsb.EventAssetsManager.ERROR_DOWNLOAD_MANIFEST:\n            case jsb.EventAssetsManager.ERROR_PARSE_MANIFEST:\n                this.panel.info.string = 'Fail to download manifest file, hot update skipped.';\n                failed = true;\n                break;\n            case jsb.EventAssetsManager.ALREADY_UP_TO_DATE:\n                this.panel.info.string = 'Already up to date with the latest remote version.';\n                failed = true;\n                break;\n            case jsb.EventAssetsManager.UPDATE_FINISHED:\n                this.panel.info.string = 'Update finished. ' + event.getMessage();\n                needRestart = true;\n                break;\n            case jsb.EventAssetsManager.UPDATE_FAILED:\n                this.panel.info.string = 'Update failed. ' + event.getMessage();\n                this.panel.retryBtn.active = true;\n                this._updating = false;\n                this._canRetry = true;\n                break;\n            case jsb.EventAssetsManager.ERROR_UPDATING:\n                this.panel.info.string = 'Asset update error: ' + event.getAssetId() + ', ' + event.getMessage();\n                break;\n            case jsb.EventAssetsManager.ERROR_DECOMPRESS:\n                this.panel.info.string = event.getMessage();\n                break;\n            default:\n                break;\n        }\n\n        if (failed) {\n            // this._am.setEventCallback(null);\n            this._updateListener = null;\n            this._updating = false;\n        }\n\n        if (needRestart) {\n            // this._am.setEventCallback(null);\n            this._updateListener = null;\n            // Prepend the manifest's search path\n            var searchPaths = jsb.fileUtils.getSearchPaths();\n            var newPaths = this._am.getLocalManifest().getSearchPaths();\n            console.log(JSON.stringify(newPaths));\n            Array.prototype.unshift.apply(searchPaths, newPaths);\n            // This value will be retrieved and appended to the default search path during game startup,\n            // please refer to samples/js-tests/main.js for detailed usage.\n            // !!! Re-add the search paths in main.js is very important, otherwise, new scripts won't take effect.\n            cc.sys.localStorage.setItem('HotUpdateSearchPaths', JSON.stringify(searchPaths));\n            jsb.fileUtils.setSearchPaths(searchPaths);\n\n            cc.audioEngine.stopAll();\n            cc.game.restart();\n        }\n    },\n\n    loadCustomManifest: function () {\n        if (this._am.getState() === jsb.AssetsManager.State.UNINITED) {\n            var manifest = new jsb.Manifest(customManifestStr, this._storagePath);\n            this._am.loadLocalManifest(manifest, this._storagePath);\n            this.panel.info.string = 'Using custom manifest';\n        }\n    },\n    \n    retry: function () {\n        if (!this._updating && this._canRetry) {\n            this.panel.retryBtn.active = false;\n            this._canRetry = false;\n            \n            this.panel.info.string = 'Retry failed Assets...';\n            this._am.downloadFailedAssets();\n        }\n    },\n    \n    checkUpdate: function () {\n        if (this._updating) {\n            this.panel.info.string = 'Checking or updating ...';\n            return;\n        }\n        if (this._am.getState() === jsb.AssetsManager.State.UNINITED) {\n            // Resolve md5 url\n            // var url = this.manifestUrl.nativeUrl;\n            var url = this.manifestUrl;\n            if (cc.loader.md5Pipe) {\n                url = cc.loader.md5Pipe.transformURL(url);\n            }\n            this._am.loadLocalManifest(url);\n        }\n        if (!this._am.getLocalManifest() || !this._am.getLocalManifest().isLoaded()) {\n            this.panel.info.string = 'Failed to load local manifest ...';\n            return;\n        }\n\n\n        // this._am.setEventCallback(this.checkCb.bind(this));\n\n        this._updateListener = new jsb.EventListenerAssetsManager(this._am, this.checkCb.bind(this));\n        cc.eventManager.addListener(this._updateListener, 1);\n\n        this._am.checkUpdate();\n        this._updating = true;\n    },\n\n    hotUpdate: function () {\n        if (this._am && !this._updating) {\n            // this._am.setEventCallback(this.updateCb.bind(this));\n\n            this._updateListener = new jsb.EventListenerAssetsManager(this._am, this.updateCb.bind(this));\n            cc.eventManager.addListener(this._updateListener, 1);\n\n            if (this._am.getState() === jsb.AssetsManager.State.UNINITED) {\n                // Resolve md5 url\n                // var url = this.manifestUrl.nativeUrl;\n                var url = this.manifestUrl;\n                if (cc.loader.md5Pipe) {\n                    url = cc.loader.md5Pipe.transformURL(url);\n                }\n                this._am.loadLocalManifest(url);\n            }\n\n            this._failCount = 0;\n            this._am.update();\n            this.panel.updateBtn.active = false;\n            this._updating = true;\n        }\n    },\n    \n    show: function () {\n        if (this.updateUI.active === false) {\n            this.updateUI.active = true;\n        }\n    },\n\n    // use this for initialization\n    onLoad: function () {\n        // Hot update is only available in Native build\n        if (!cc.sys.isNative) {\n            return;\n        }\n        this._storagePath = ((jsb.fileUtils ? jsb.fileUtils.getWritablePath() : '/') + 'blackjack-remote-asset');\n        cc.log('Storage path for remote asset : ' + this._storagePath);\n\n        // Setup your own version compare handler, versionA and B is versions in string\n        // if the return value greater than 0, versionA is greater than B,\n        // if the return value equals 0, versionA equals to B,\n        // if the return value smaller than 0, versionA is smaller than B.\n        this.versionCompareHandle = function (versionA, versionB) {\n            cc.log(\"JS Custom Version Compare: version A is \" + versionA + ', version B is ' + versionB);\n            var vA = versionA.split('.');\n            var vB = versionB.split('.');\n            for (var i = 0; i < vA.length; ++i) {\n                var a = parseInt(vA[i]);\n                var b = parseInt(vB[i] || 0);\n                if (a === b) {\n                    continue;\n                }\n                else {\n                    return a - b;\n                }\n            }\n            if (vB.length > vA.length) {\n                return -1;\n            }\n            else {\n                return 0;\n            }\n        };\n\n        // Init with empty manifest url for testing custom manifest\n        this._am = new jsb.AssetsManager('', this._storagePath, this.versionCompareHandle);\n\n        var panel = this.panel;\n        // Setup the verification callback, but we don't have md5 check function yet, so only print some message\n        // Return true if the verification passed, otherwise return false\n        this._am.setVerifyCallback(function (path, asset) {\n            // When asset is compressed, we don't need to check its md5, because zip file have been deleted.\n            var compressed = asset.compressed;\n            // Retrieve the correct md5 value.\n            var expectedMD5 = asset.md5;\n            // asset.path is relative path and path is absolute.\n            var relativePath = asset.path;\n            // The size of asset file, but this value could be absent.\n            var size = asset.size;\n            if (compressed) {\n                panel.info.string = \"Verification passed : \" + relativePath;\n                return true;\n            }\n            else {\n                panel.info.string = \"Verification passed : \" + relativePath + ' (' + expectedMD5 + ')';\n                return true;\n            }\n        });\n\n        this.panel.info.string = 'Hot update is ready, please check or directly update.';\n\n        if (cc.sys.os === cc.sys.OS_ANDROID) {\n            // Some Android device may slow down the download process when concurrent tasks is too much.\n            // The value may not be accurate, please do more test and find what's most suitable for your game.\n            this._am.setMaxConcurrentTask(2);\n            this.panel.info.string = \"Max concurrent tasks count have been limited to 2\";\n        }\n        \n        this.panel.fileProgress.progress = 0;\n        this.panel.byteProgress.progress = 0;\n    },\n\n    onDestroy: function () {\n        if (this._updateListener) {\n            // this._am.setEventCallback(null);\n            cc.eventManager.removeListener(this._updateListener);\n            this._updateListener = null;\n        }\n    }\n});\n"]}